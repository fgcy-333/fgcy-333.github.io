

<!DOCTYPE html>
<html lang="en" data-default-color-scheme=auto>



<head>
  <meta charset="UTF-8">
  <link rel="apple-touch-icon" sizes="76x76" href="/img/fluid.png">
  <link rel="icon" href="/img/fluid.png">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, shrink-to-fit=no">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  
  <meta name="theme-color" content="#2f4154">
  <meta name="author" content="John Doe">
  <meta name="keywords" content="">
  
    <meta name="description" content="⼀、MyBatis概述1.1 框架在⽂献中看到的framework 被翻译为框架  Java常⽤框架：  SSM三⼤框架：Spring + SpringMVC + MyBatis   SpringBoot   SpringCloud 等   框架其实就是对通⽤代码的封装，提前写好了⼀堆接⼝和类，我们可以在做项⽬的时候直接引⼊这些 接⼝和类（引⼊框架），基于这些现有的接⼝和类进⾏开发，可以⼤⼤提⾼开">
<meta property="og:type" content="article">
<meta property="og:title" content="Mybatis(du)">
<meta property="og:url" content="http://example.com/2023/05/14/%E8%80%81%E6%9D%9C-Mybatis/index.html">
<meta property="og:site_name" content="FGCY-BLOG">
<meta property="og:description" content="⼀、MyBatis概述1.1 框架在⽂献中看到的framework 被翻译为框架  Java常⽤框架：  SSM三⼤框架：Spring + SpringMVC + MyBatis   SpringBoot   SpringCloud 等   框架其实就是对通⽤代码的封装，提前写好了⼀堆接⼝和类，我们可以在做项⽬的时候直接引⼊这些 接⼝和类（引⼊框架），基于这些现有的接⼝和类进⾏开发，可以⼤⼤提⾼开">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="http://example.com/images/mybatis.png">
<meta property="article:published_time" content="2023-05-14T03:27:56.000Z">
<meta property="article:modified_time" content="2023-05-19T15:07:17.316Z">
<meta property="article:author" content="John Doe">
<meta property="article:tag" content="java">
<meta property="article:tag" content="SSM">
<meta property="article:tag" content="MyBatis">
<meta property="article:tag" content="ORM框架">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:image" content="http://example.com/images/mybatis.png">
  
  
    <meta name="referrer" content="no-referrer-when-downgrade">
  
  
  <title>Mybatis(du) - FGCY-BLOG</title>

  <link  rel="stylesheet" href="https://lib.baomitu.com/twitter-bootstrap/4.6.1/css/bootstrap.min.css" />



  <link  rel="stylesheet" href="https://lib.baomitu.com/github-markdown-css/4.0.0/github-markdown.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/hint.css/2.7.0/hint.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.css" />



<!-- 主题依赖的图标库，不要自行修改 -->
<!-- Do not modify the link that theme dependent icons -->

<link rel="stylesheet" href="//at.alicdn.com/t/font_1749284_hj8rtnfg7um.css">



<link rel="stylesheet" href="//at.alicdn.com/t/font_1736178_lbnruvf0jn.css">


<link  rel="stylesheet" href="/css/main.css" />


  <link id="highlight-css" rel="stylesheet" href="/css/highlight.css" />
  
    <link id="highlight-css-dark" rel="stylesheet" href="/css/highlight-dark.css" />
  




  <script id="fluid-configs">
    var Fluid = window.Fluid || {};
    Fluid.ctx = Object.assign({}, Fluid.ctx)
    var CONFIG = {"hostname":"example.com","root":"/","version":"1.9.4","typing":{"enable":true,"typeSpeed":333,"cursorChar":"%","loop":true,"scope":[]},"anchorjs":{"enable":true,"element":"h1,h2,h3,h4,h5,h6","placement":"left","visible":"hover","icon":""},"progressbar":{"enable":true,"height_px":3,"color":"#29d","options":{"showSpinner":false,"trickleSpeed":100}},"code_language":{"enable":true,"default":"TEXT"},"copy_btn":true,"image_caption":{"enable":true},"image_zoom":{"enable":true,"img_url_replace":["",""]},"toc":{"enable":true,"placement":"right","headingSelector":"h1,h2,h3,h4,h5,h6","collapseDepth":0},"lazyload":{"enable":true,"loading_img":"/img/loading.gif","onlypost":false,"offset_factor":2},"web_analytics":{"enable":false,"follow_dnt":true,"baidu":null,"google":null,"gtag":null,"tencent":{"sid":null,"cid":null},"woyaola":null,"cnzz":null,"leancloud":{"app_id":null,"app_key":null,"server_url":null,"path":"window.location.pathname","ignore_local":false}},"search_path":"/local-search.xml"};

    if (CONFIG.web_analytics.follow_dnt) {
      var dntVal = navigator.doNotTrack || window.doNotTrack || navigator.msDoNotTrack;
      Fluid.ctx.dnt = dntVal && (dntVal.startsWith('1') || dntVal.startsWith('yes') || dntVal.startsWith('on'));
    }
  </script>
  <script  src="/js/utils.js" ></script>
  <script  src="/js/color-schema.js" ></script>
  


  
<meta name="generator" content="Hexo 6.3.0"></head>


<body>
  

  <header>
    

<div class="header-inner" style="height: 70vh;">
  <nav id="navbar" class="navbar fixed-top  navbar-expand-lg navbar-dark scrolling-navbar">
  <div class="container">
    <a class="navbar-brand" href="/">
      <strong>FGCY-BLOG</strong>
    </a>

    <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse"
            data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <div class="animated-icon"><span></span><span></span><span></span></div>
    </button>

    <!-- Collapsible content -->
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav ml-auto text-center">
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/">
                <i class="iconfont icon-home-fill"></i>
                <span>Home</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/categories/">
                <i class="iconfont icon-category-fill"></i>
                <span>type</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/tags/">
                <i class="iconfont icon-tags-fill"></i>
                <span>Tags</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/about/">
                <i class="iconfont icon-user-fill"></i>
                <span>null</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/playlist/">
                <i class="iconfont icon-music"></i>
                <span>music</span>
              </a>
            </li>
          
        
        
          <li class="nav-item" id="search-btn">
            <a class="nav-link" target="_self" href="javascript:;" data-toggle="modal" data-target="#modalSearch" aria-label="Search">
              <i class="iconfont icon-search"></i>
            </a>
          </li>
          
        
        
          <li class="nav-item" id="color-toggle-btn">
            <a class="nav-link" target="_self" href="javascript:;" aria-label="Color Toggle">
              <i class="iconfont icon-dark" id="color-toggle-icon"></i>
            </a>
          </li>
        
      </ul>
    </div>
  </div>
</nav>

  

<div id="banner" class="banner" parallax=true
     style="background: url('/img/default.png') no-repeat center center; background-size: cover;">
  <div class="full-bg-img">
    <div class="mask flex-center" style="background-color: rgba(0, 0, 0, 0.3)">
      <div class="banner-text text-center fade-in-up">
        <div class="h2">
          
            <span id="subtitle" data-typed-text="Mybatis(du)"></span>
          
        </div>

        
          
  <div class="mt-3">
    
    
      <span class="post-meta">
        <i class="iconfont icon-date-fill" aria-hidden="true"></i>
        <time datetime="2023-05-14 11:27" pubdate>
          May 14, 2023 am
        </time>
      </span>
    
  </div>

  <div class="mt-1">
    

    

    
    
      
        <span id="busuanzi_container_page_pv" style="display: none">
          <i class="iconfont icon-eye" aria-hidden="true"></i>
          <span id="busuanzi_value_page_pv"></span> views
        </span>
        
      
    
  </div>


        
      </div>

      
    </div>
  </div>
</div>

</div>

  </header>

  <main>
    
      

<div class="container-fluid nopadding-x">
  <div class="row nomargin-x">
    <div class="side-col d-none d-lg-block col-lg-2">
      

    </div>

    <div class="col-lg-8 nopadding-x-md">
      <div class="container nopadding-x-md" id="board-ctn">
        <div id="board">
          <article class="post-content mx-auto">
            <!-- SEO header -->
            <h1 style="display: none">Mybatis(du)</h1>
            
            
              <div class="markdown-body">
                
                <h1 id="⼀、MyBatis概述"><a href="#⼀、MyBatis概述" class="headerlink" title="⼀、MyBatis概述"></a>⼀、MyBatis概述</h1><h2 id="1-1-框架"><a href="#1-1-框架" class="headerlink" title="1.1 框架"></a>1.1 框架</h2><p>在⽂献中看到的<code>framework</code> 被翻译为框架</p>
<p> Java常⽤框架：</p>
<ul>
<li><p>SSM三⼤框架：Spring + SpringMVC + MyBatis </p>
</li>
<li><p>SpringBoot </p>
</li>
<li><p>SpringCloud 等</p>
</li>
</ul>
<p>框架其实就是对通⽤代码的封装，提前写好了⼀堆接⼝和类，我们可以在做项⽬的时候直接引⼊这些 接⼝和类（引⼊框架），基于这些现有的接⼝和类进⾏开发，可以⼤⼤提⾼开发效率。</p>
<p> 框架⼀般都以jar包的形式存在。(jar包中有class⽂件以及各种配置⽂件等)</p>
<hr>
<p>SSM三⼤框架的学习顺序： </p>
<ul>
<li><p>⽅式⼀：MyBatis、Spring、SpringMVC（建议） </p>
</li>
<li><p>⽅式⼆：Spring、MyBatis、SpringMVC</p>
</li>
</ul>
<h2 id="1-2-三层架构"><a href="#1-2-三层架构" class="headerlink" title="1.2 三层架构"></a>1.2 三层架构</h2><p>纵向看是三层架构 横向看是MVC架构模式</p>
<hr>
<p><img src="https://cdn.jsdelivr.net/gh/fgcy-333/gitnote-images/2023/5/14202305160004016.png" srcset="/img/loading.gif" lazyload alt="image-20230516000450188"></p>
<hr>
<p>表现层（UI）：直接跟客户端打交互（⼀是接收前端ajax请求，⼆是返回json数据或页面给前端） 【Controller+View】</p>
<p>业务逻辑层（BLL）：⼀是处理表现层转发过来的前端请求（也就是具体业务），⼆是将从持久层获 取的数据返回到表现层【Model中的service】</p>
<p>数据访问层（DAL）：直接操作数据库完成CRUD，并将获得的数据返回到上⼀层（也就是业务逻辑层）【Model中的Dao】</p>
<p>Java持久层框架： </p>
<p>​	MyBatis </p>
<p>​	Hibernate（实现了JPA规范） </p>
<p>​	jOOQ </p>
<p>​	Guzz </p>
<p>​	Spring Data（实现了JPA规范） </p>
<p>​	ActiveJDBC …… </p>
<h2 id="1-3-JDBC不⾜"><a href="#1-3-JDBC不⾜" class="headerlink" title="1.3 JDBC不⾜"></a>1.3 JDBC不⾜</h2><p>示例代码1： </p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// ......</span><br><span class="hljs-comment">// sql语句写死在java程序中</span><br><span class="hljs-type">String</span> <span class="hljs-variable">sql</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;insert into t_user(id,idCard,username,password,birth,gender,email,city,street,zipcode,phone,grade) values(?,?,?,?,?,?,?,?,?,?,?,?)&quot;</span>;<br><span class="hljs-type">PreparedStatement</span> <span class="hljs-variable">ps</span> <span class="hljs-operator">=</span> conn.prepareStatement(sql);<br><span class="hljs-comment">// 繁琐的赋值：思考⼀下，这种有规律的代码能不能通过反射机制来做⾃动化。</span><br>ps.setString(<span class="hljs-number">1</span>, <span class="hljs-string">&quot;1&quot;</span>);<br>ps.setString(<span class="hljs-number">2</span>, <span class="hljs-string">&quot;123456789&quot;</span>);<br>ps.setString(<span class="hljs-number">3</span>, <span class="hljs-string">&quot;zhangsan&quot;</span>);<br>ps.setString(<span class="hljs-number">4</span>, <span class="hljs-string">&quot;123456&quot;</span>);<br>ps.setString(<span class="hljs-number">5</span>, <span class="hljs-string">&quot;1980-10-11&quot;</span>);<br>ps.setString(<span class="hljs-number">6</span>, <span class="hljs-string">&quot;男&quot;</span>);<br>ps.setString(<span class="hljs-number">7</span>, <span class="hljs-string">&quot;zhangsan@126.com&quot;</span>);<br>ps.setString(<span class="hljs-number">8</span>, <span class="hljs-string">&quot;北京&quot;</span>);<br>ps.setString(<span class="hljs-number">9</span>, <span class="hljs-string">&quot;⼤兴区凉⽔河⼆街&quot;</span>);<br>ps.setString(<span class="hljs-number">10</span>, <span class="hljs-string">&quot;1000000&quot;</span>);<br>ps.setString(<span class="hljs-number">11</span>, <span class="hljs-string">&quot;16398574152&quot;</span>);<br>ps.setString(<span class="hljs-number">12</span>, <span class="hljs-string">&quot;A&quot;</span>);<br><span class="hljs-comment">// 执⾏SQL</span><br><span class="hljs-type">int</span> <span class="hljs-variable">count</span> <span class="hljs-operator">=</span> ps.executeUpdate();<br><span class="hljs-comment">// ......</span><br></code></pre></td></tr></table></figure>

<blockquote>
<p>硬编码 改sql语句就是改源代码 需要</p>
</blockquote>
<p>示例代码2：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// ......</span><br><span class="hljs-comment">// sql语句写死在java程序中</span><br><span class="hljs-type">String</span> <span class="hljs-variable">sql</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;select id,idCard,username,password,birth,gender,email,city,s</span><br><span class="hljs-string">treet,zipcode,phone,grade from t_user&quot;</span>;<br><span class="hljs-type">PreparedStatement</span> <span class="hljs-variable">ps</span> <span class="hljs-operator">=</span> conn.prepareStatement(sql);<br><span class="hljs-type">ResultSet</span> <span class="hljs-variable">rs</span> <span class="hljs-operator">=</span> ps.executeQuery();<br>List&lt;User&gt; userList = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;();<br><span class="hljs-comment">// 思考以下循环中的所有代码是否可以使⽤反射进⾏⾃动化封装。</span><br><span class="hljs-keyword">while</span>(rs.next())&#123;<br> <span class="hljs-comment">// 获取数据</span><br> <span class="hljs-type">String</span> <span class="hljs-variable">id</span> <span class="hljs-operator">=</span> rs.getString(<span class="hljs-string">&quot;id&quot;</span>);<br> <span class="hljs-type">String</span> <span class="hljs-variable">idCard</span> <span class="hljs-operator">=</span> rs.getString(<span class="hljs-string">&quot;idCard&quot;</span>);<br> <span class="hljs-type">String</span> <span class="hljs-variable">username</span> <span class="hljs-operator">=</span> rs.getString(<span class="hljs-string">&quot;username&quot;</span>);<br> <span class="hljs-type">String</span> <span class="hljs-variable">password</span> <span class="hljs-operator">=</span> rs.getString(<span class="hljs-string">&quot;password&quot;</span>);<br> <span class="hljs-type">String</span> <span class="hljs-variable">birth</span> <span class="hljs-operator">=</span> rs.getString(<span class="hljs-string">&quot;birth&quot;</span>);<br> <span class="hljs-type">String</span> <span class="hljs-variable">gender</span> <span class="hljs-operator">=</span> rs.getString(<span class="hljs-string">&quot;gender&quot;</span>);<br> <span class="hljs-type">String</span> <span class="hljs-variable">email</span> <span class="hljs-operator">=</span> rs.getString(<span class="hljs-string">&quot;email&quot;</span>);<br> <span class="hljs-type">String</span> <span class="hljs-variable">city</span> <span class="hljs-operator">=</span> rs.getString(<span class="hljs-string">&quot;city&quot;</span>);<br> <span class="hljs-type">String</span> <span class="hljs-variable">street</span> <span class="hljs-operator">=</span> rs.getString(<span class="hljs-string">&quot;street&quot;</span>);<br> <span class="hljs-type">String</span> <span class="hljs-variable">zipcode</span> <span class="hljs-operator">=</span> rs.getString(<span class="hljs-string">&quot;zipcode&quot;</span>);<br> <span class="hljs-type">String</span> <span class="hljs-variable">phone</span> <span class="hljs-operator">=</span> rs.getString(<span class="hljs-string">&quot;phone&quot;</span>);<br> <span class="hljs-type">String</span> <span class="hljs-variable">grade</span> <span class="hljs-operator">=</span> rs.getString(<span class="hljs-string">&quot;grade&quot;</span>);<br> <span class="hljs-comment">// 创建对象</span><br> <span class="hljs-type">User</span> <span class="hljs-variable">user</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">User</span>();<br> <span class="hljs-comment">// 给对象属性赋值</span><br> user.setId(id);<br> user.setIdCard(idCard);<br> user.setUsername(username);<br> user.setPassword(password);<br> user.setBirth(birth);<br> user.setGender(gender);<br> user.setEmail(email);<br> user.setCity(city);<br> user.setStreet(street);<br> user.setZipcode(zipcode);<br> user.setPhone(phone);<br> user.setGrade(grade);<br> <span class="hljs-comment">// 添加到集合</span><br> userList.add(user);<br>&#125;<br><span class="hljs-comment">// ......</span><br></code></pre></td></tr></table></figure>

<blockquote>
<p> JDBC不⾜：</p>
<ul>
<li><p>SQL语句写死在Java程序中，不灵活。改SQL的话就要改Java代码。违背开闭原则OCP</p>
</li>
<li><p>给 <code>?</code> 占位符传值是繁琐的</p>
</li>
<li><p>将结果集封装成Java对象是繁琐的</p>
</li>
</ul>
</blockquote>
<h2 id="1-4-了解MyBatis"><a href="#1-4-了解MyBatis" class="headerlink" title="1.4 了解MyBatis"></a>1.4 了解MyBatis</h2><p>MyBatis本质上就是对JDBC的封装，通过MyBatis完成CRUD</p>
<p>MyBatis在三层架构中负责持久层的，属于持久层框架</p>
<p>MyBatis的发展历程：【引⽤百度百科】 </p>
<ul>
<li>MyBatis本是apache的⼀个开源项⽬iBatis，2010年这个项⽬由apache software foundation迁 移到了google code，并且改名为MyBatis。2013年11⽉迁移到Github。 </li>
<li>iBATIS⼀词来源于“internet”和“abatis”的组合，是⼀个基于Java的持久层框架。iBATIS提供的 持久层框架包括SQL Maps和Data Access Objects（DAOs）【Dao javaEE的一种设计模式 是一个专门用于数据库增删改查的一个类 数据访问对象】</li>
</ul>
<p>打开mybatis代码可以看到它的包结构中包含：ibatis</p>
<p>**ORM：对象关系映射 **</p>
<p>O（Object）：Java虚拟机中的Java对象 </p>
<p>R（Relational）：关系型数据库 </p>
<p>M（Mapping）：将Java虚拟机中的Java对象映射到数据库表中⼀⾏记录，或是将数据库表中 ⼀⾏记录映射成Java虚拟机中的⼀个Java对象</p>
<p>ORM图示：</p>
<hr>
<img src="https://cdn.jsdelivr.net/gh/fgcy-333/gitnote-images/2023/5/16202305160030348.png" srcset="/img/loading.gif" lazyload alt="image-20230516003038853" style="zoom:67%;" />

<hr>
<p><img src="https://cdn.jsdelivr.net/gh/fgcy-333/gitnote-images/2023/5/16202305160034154.png" srcset="/img/loading.gif" lazyload alt="image-20230516003420138"></p>
<hr>
<blockquote>
<p>MyBatis框架就是一个ORM框架</p>
<p>MyBatis可以干啥？java对象&lt;—-&gt;数据库表中的一条记录</p>
</blockquote>
<hr>
<p>MyBatis是一个半自动化的ORM,因为MyBatis框架中SQL语句是需要程序员自己编写的</p>
<p>iHibernate框架就是一个全自动化的ORM.使用Hibernate框架的时候，不需要程序员手动编写SQL语句，SQL语句可以自动生成。所以Hibernate是一个完全的全自动化的ORM框架。</p>
<p><strong>MyBatis框架特点：</strong> </p>
<ul>
<li>⽀持定制化 SQL、存储过程、基本映射以及⾼级映射 (一对多等)</li>
<li>避免了⼏乎所有的 JDBC 代码中⼿动设置参数以及获取结果集 </li>
<li>⽀持XML开发，也⽀持注解式开发。【为了保证sql语句的灵活，所以mybatis⼤部分是采⽤ XML⽅式开发】 </li>
<li>将接⼝和 Java 的 POJOs(Plain Ordinary Java Object，简单普通的Java对象)映射成数据库中的记录 </li>
<li>体积⼩好学：两个jar包(一个mybatis的包、一个数据库连接包)，两个XML配置⽂件</li>
<li>完全做到sql解耦合</li>
<li>提供了基本映射标签</li>
<li>提供了⾼级映射标签</li>
<li>提供了XML标签，⽀持动态SQL的编写</li>
</ul>
<h1 id="⼆、MyBatis⼊⻔程序"><a href="#⼆、MyBatis⼊⻔程序" class="headerlink" title="⼆、MyBatis⼊⻔程序"></a>⼆、MyBatis⼊⻔程序</h1><p>只要你会JDBC，MyBatis就可以学</p>
<h2 id="2-1-版本"><a href="#2-1-版本" class="headerlink" title="2.1 版本"></a>2.1 版本</h2><p>软件版本：<code>IntelliJ IDEA </code>  <code>Navicat for MySQL </code>  <code>MySQL数据库：8.0.30</code></p>
<p>组件版本：MySQL驱动：8.0.30   MyBatis：3.5.10   JDK：Java17    JUnit：4.13.2   Logback：1.2.11</p>
<h2 id="2-2-MyBatis下载"><a href="#2-2-MyBatis下载" class="headerlink" title="2.2 MyBatis下载"></a>2.2 MyBatis下载</h2><p>从github上下载，地址：<a target="_blank" rel="noopener" href="https://github.com/mybatis/mybatis-3">https://github.com/mybatis/mybatis-3</a></p>
<p>Mybatis中文网：<a target="_blank" rel="noopener" href="https://mybatis.net.cn/">https://mybatis.net.cn/</a></p>
<hr>
<img src="https://cdn.jsdelivr.net/gh/fgcy-333/gitnote-images/2023/5/16202305160042420.png" srcset="/img/loading.gif" lazyload alt="image-20230516004129210" style="zoom:80%;" />

<hr>
<p><img src="https://cdn.jsdelivr.net/gh/fgcy-333/gitnote-images/2023/5/16202305160042268.png" srcset="/img/loading.gif" lazyload alt="image-20230516004153108"></p>
<hr>
<p>将框架以及框架的源码都下载下来，下载框架后解压，打开mybatis⽬录</p>
<hr>
<p><img src="https://cdn.jsdelivr.net/gh/fgcy-333/gitnote-images/2023/5/16202305160042037.png" srcset="/img/loading.gif" lazyload alt="image-20230516004228702"></p>
<hr>
<p>通过以上解压可以看到，框架⼀般都是以jar包的形式存在。我们的mybatis课程使⽤maven，所 以这个jar我们不需要。 官⽅⼿册需要。</p>
<h2 id="2-3-MyBatis⼊⻔程序开发步骤"><a href="#2-3-MyBatis⼊⻔程序开发步骤" class="headerlink" title="2.3 MyBatis⼊⻔程序开发步骤"></a>2.3 MyBatis⼊⻔程序开发步骤</h2><p><strong>1、写代码前准备： 准备数据库表：</strong></p>
<p>汽⻋表t_car，字段包括：</p>
<ul>
<li><p>id：主键（⾃增）【bigint】 </p>
</li>
<li><p>car_num：汽⻋编号【varchar】 </p>
</li>
<li><p>brand：品牌【varchar】 </p>
</li>
<li><p>guide_price：⼚家指导价【decimal类型，专⻔为财务数据准备的类型】 </p>
</li>
<li><p>produce_time：⽣产时间【char，年⽉⽇即可，10个⻓度，’2022-10-11’】 </p>
</li>
<li><p>car_type：汽⻋类型（燃油⻋、电⻋、氢能源）【varchar】</p>
</li>
</ul>
<p><strong>2、使⽤navicat for mysql⼯具建表</strong></p>
<hr>
<p><img src="https://cdn.jsdelivr.net/gh/fgcy-333/gitnote-images/2023/5/16202305160043772.png" srcset="/img/loading.gif" lazyload alt="image-20230516004353829"></p>
<hr>
<p><strong>3、使⽤navicat for mysql⼯具向t_car表中插⼊两条数据，如下：</strong></p>
<hr>
<p><img src="https://cdn.jsdelivr.net/gh/fgcy-333/gitnote-images/2023/5/16202305160044956.png" srcset="/img/loading.gif" lazyload alt="image-20230516004410622"></p>
<hr>
<p><strong>4、创建Project：建议创建Empty Project，设置Java版本以及编译版本等</strong></p>
<p><strong>5、创建Module：普通的Maven Java模块</strong></p>
<p><strong>6、修改pom文件</strong></p>
<p>步骤1：打包⽅式：jar（不需要war，因为mybatis封装的是jdbc，不需要放到tomcat中运行）</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.powernode<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>mybatis-001-introduction<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>1.0-SNAPSHOT<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">packaging</span>&gt;</span>jar<span class="hljs-tag">&lt;/<span class="hljs-name">packaging</span>&gt;</span><br></code></pre></td></tr></table></figure>

<p>步骤2：引⼊依赖（mybatis依赖 + mysql驱动依赖）</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-comment">&lt;!--mybatis核⼼依赖--&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br> <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.mybatis<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br> <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>mybatis<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br> <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>3.5.10<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br><br><span class="hljs-comment">&lt;!--mysql驱动依赖--&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br> <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>mysql<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br> <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>mysql-connector-java<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br> <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>8.0.30<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br></code></pre></td></tr></table></figure>

<p>步骤3：在resources根⽬录下新建mybatis-config.xml配置⽂件（可以参考mybatis⼿册拷⻉）</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-meta">&lt;?xml version=<span class="hljs-string">&quot;1.0&quot;</span> encoding=<span class="hljs-string">&quot;UTF-8&quot;</span> ?&gt;</span><br><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">configuration</span></span><br><span class="hljs-meta"> <span class="hljs-keyword">PUBLIC</span> <span class="hljs-string">&quot;-//mybatis.org//DTD Config 3.0//EN&quot;</span></span><br><span class="hljs-meta"> <span class="hljs-string">&quot;http://mybatis.org/dtd/mybatis-3-config.dtd&quot;</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">configuration</span>&gt;</span><br> <span class="hljs-tag">&lt;<span class="hljs-name">environments</span> <span class="hljs-attr">default</span>=<span class="hljs-string">&quot;development&quot;</span>&gt;</span><br>     <span class="hljs-tag">&lt;<span class="hljs-name">environment</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;development&quot;</span>&gt;</span><br>     <span class="hljs-tag">&lt;<span class="hljs-name">transactionManager</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;JDBC&quot;</span>/&gt;</span><br>     <span class="hljs-comment">&lt;!--数据源--&gt;</span><br>     <span class="hljs-tag">&lt;<span class="hljs-name">dataSource</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;POOLED&quot;</span>&gt;</span><br>         <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;driver&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;com.mysql.cj.jdbc.Driver&quot;</span>/&gt;</span><br>         <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;url&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;jdbc:mysql://localhost:3306/powernode&quot;</span>/&gt;</span><br>         <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;username&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;root&quot;</span>/&gt;</span><br>         <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;password&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;root&quot;</span>/&gt;</span><br>     <span class="hljs-tag">&lt;/<span class="hljs-name">dataSource</span>&gt;</span><br>     <span class="hljs-tag">&lt;/<span class="hljs-name">environment</span>&gt;</span><br> <span class="hljs-tag">&lt;/<span class="hljs-name">environments</span>&gt;</span><br>    <br> <span class="hljs-tag">&lt;<span class="hljs-name">mappers</span>&gt;</span><br>     <span class="hljs-comment">&lt;!--sql映射⽂件创建好之后，需要将该⽂件路径配置到这⾥--&gt;</span><br>     <span class="hljs-comment">&lt;!--resource属性自动会从类的根路径下开始查找资源--&gt;</span><br>     <span class="hljs-tag">&lt;<span class="hljs-name">mapper</span> <span class="hljs-attr">resource</span>=<span class="hljs-string">&quot;&quot;</span>/&gt;</span><br> <span class="hljs-tag">&lt;/<span class="hljs-name">mappers</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">configuration</span>&gt;</span><br></code></pre></td></tr></table></figure>

<blockquote>
<p>注意1：mybatis核⼼配置⽂件的⽂件名不⼀定是mybatis-config.xml，可以是其它名字</p>
<p>注意2：mybatis核⼼配置⽂件存放在resources根下，相当于放到了类的根路径下。放在这个目录当中的,一般都是资源文件,配置文件。</p>
</blockquote>
<p>步骤4：在resources根⽬录下新建CarMapper.xml配置⽂件（可以参考mybatis⼿册拷⻉）</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-meta">&lt;?xml version=<span class="hljs-string">&quot;1.0&quot;</span> encoding=<span class="hljs-string">&quot;UTF-8&quot;</span> ?&gt;</span><br><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">mapper</span></span><br><span class="hljs-meta"> <span class="hljs-keyword">PUBLIC</span> <span class="hljs-string">&quot;-//mybatis.org//DTD Mapper 3.0//EN&quot;</span></span><br><span class="hljs-meta"> <span class="hljs-string">&quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;</span>&gt;</span><br><span class="hljs-comment">&lt;!--namespace先随意写⼀个--&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">mapper</span> <span class="hljs-attr">namespace</span>=<span class="hljs-string">&quot;car&quot;</span>&gt;</span><br> <span class="hljs-comment">&lt;!--insert语句，id是这条SQL语句的唯一标识。这个id就代表了这条SQL语句--&gt;</span><br> <span class="hljs-tag">&lt;<span class="hljs-name">insert</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;insertCar&quot;</span>&gt;</span><br>     insert into t_car<br>     (id,car_num,brand,guide_price,produce_time,car_type)<br>     values<br>     (null,&#x27;102&#x27;,&#x27;丰⽥mirai&#x27;,40.30,&#x27;2014-10-05&#x27;,&#x27;氢能源&#x27;)<br>     <span class="hljs-comment">&lt;!--可以不以 ； 结尾--&gt;</span><br> <span class="hljs-tag">&lt;/<span class="hljs-name">insert</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">mapper</span>&gt;</span><br></code></pre></td></tr></table></figure>

<blockquote>
<p>注意1：sql语句最后结尾可以不写“;” </p>
<p>注意2：CarMapper.xml⽂件的名字不是固定的。可以使⽤其它名字。</p>
<p>注意3：CarMapper.xml⽂件的位置也是随意的。这⾥选择放在resources根下，相当于放到了类的根路 径下</p>
<p>注意四：mybatis中有两个主要的配置文件：</p>
<ul>
<li>mybatis-config.xml，这是核心配置文件，主要配置连接数据库的信息等。 </li>
<li>XxxxMapper.xml,这个文件是专门用来编写SQL语句的配置文件(一个表一个) </li>
<li>t_user表，一般会对应一个UserMapper.xml</li>
<li>t_student表，一般会对应一个StudentMapper.xml</li>
</ul>
</blockquote>
<p>步骤5：将CarMapper.xml⽂件路径配置到mybatis-config.xml：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-comment">&lt;!--resource属性自动会从类的根路径下开始查找资源--&gt;</span><br><span class="hljs-comment">&lt;!--如果CarMapper.xml文件在resource.com包下    那么要这么写    com/CarMapper.xml--&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">mapper</span> <span class="hljs-attr">resource</span>=<span class="hljs-string">&quot;CarMapper.xml&quot;</span>/&gt;</span><br></code></pre></td></tr></table></figure>

<blockquote>
<p>url属性:从绝对路径当中加载资源  语法格式: file:&#x2F;&#x2F;&#x2F;绝对路径    【不建议 移植性差】</p>
</blockquote>
<p>步骤6：编写MyBatisIntroductionTest代码</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.powernode.mybatis;<br><span class="hljs-keyword">import</span> org.apache.ibatis.session.SqlSession;<br><span class="hljs-keyword">import</span> org.apache.ibatis.session.SqlSessionFactory;<br><span class="hljs-keyword">import</span> org.apache.ibatis.session.SqlSessionFactoryBuilder;<br><span class="hljs-keyword">import</span> java.io.InputStream;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MyBatisIntroductionTest</span> &#123;<br>     <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>         <span class="hljs-comment">// 1. 创建SqlSessionFactoryBuilder对象</span><br>         <span class="hljs-type">SqlSessionFactoryBuilder</span> <span class="hljs-variable">sqlSessionFactoryBuilder</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">SqlSessionFactoryBuilder</span>();<br>         <br>         <span class="hljs-comment">// 2. 创建SqlSessionFactory对象</span><br>         <span class="hljs-comment">// Resources.getResourceAsStream默认就是从类的根路径下开始查找资源 底层源代码就是通过类加载器获取类路径下文件字节流</span><br>         <span class="hljs-comment">//InputStream is = Resources.getResourceAsStream(&quot;mybatis-config.xml&quot;);</span><br>         <span class="hljs-type">InputStream</span> <span class="hljs-variable">is</span> <span class="hljs-operator">=</span> Thread.currentThread().getContextClassLoader().getResourceAsStream(<span class="hljs-string">&quot;mybatis-config.xml&quot;</span>);<br>         <br>         <span class="hljs-comment">// 一般情况下都是一个数据库对应一个SqlSessionFactory对象</span><br>         <span class="hljs-type">SqlSessionFactory</span> <span class="hljs-variable">sqlSessionFactory</span> <span class="hljs-operator">=</span> sqlSessionFactoryBuilder.build(is);<br>         <br>         <span class="hljs-comment">// 3. 创建SqlSession对象</span><br>         <span class="hljs-type">SqlSession</span> <span class="hljs-variable">sqlSession</span> <span class="hljs-operator">=</span> sqlSessionFactory.openSession();<br>         <br>         <span class="hljs-comment">// 4. 执⾏sql</span><br>         <span class="hljs-comment">// 这个&quot;insertCar&quot;必须是sql的id</span><br>         System.out.println(<span class="hljs-string">&quot;插⼊⼏条数据：&quot;</span> + count);<br>         <span class="hljs-type">int</span> <span class="hljs-variable">count</span> <span class="hljs-operator">=</span> sqlSession.insert(<span class="hljs-string">&quot;insertCar&quot;</span>); <br>         <br>         <span class="hljs-comment">// 5. 提交（mybatis默认采⽤的事务管理器是JDBC，默认是不提交的，需要⼿动提交）</span><br>         sqlSession.commit();<br>         <br>         <span class="hljs-comment">// 6. 关闭资源（只关闭是不会提交的）</span><br>         sqlSession.close();<br>     &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<blockquote>
<p>注意1：默认采⽤的事务管理器是：JDBC。JDBC事务默认是不提交的，需要⼿动提交</p>
</blockquote>
<p>在MyBatis当中，负责执行SQL语句的那个对象叫做什么呢？</p>
<p>SqlSessionSqlSession是专门用来执行SQL语句的，是一个Java程序和数据库之间的一次会话</p>
<p>要想获取SqlSession对象,需要先获取SqlSessionFactory对象,通过SqlSessionFactory工厂来生产SqlSession</p>
<hr>
<p>怎么获取SqlSessionFactory对象呢？</p>
<p>需要首先获取SqlSessionFactoryBuilder对象。通过SqlSessionFactoryBuilder对象的build方法，来获取一个SqlSessionFactory对象</p>
<hr>
<p>mybatis的核心对象包括：SqlSessionFactoryBuilder  SqlSessionFactory   SqlSessionSql   </p>
<p>创建关系：SessionFactoryBuilder –&gt; SqlSessionFactory –&gt; SqlSession</p>
<p>步骤7：运⾏程序，查看运⾏结果，以及数据库表中的数据</p>
<hr>
<p><img src="https://cdn.jsdelivr.net/gh/fgcy-333/gitnote-images/2023/5/16202305160121368.png" srcset="/img/loading.gif" lazyload alt="image-20230516012151430"></p>
<hr>
<p><img src="https://cdn.jsdelivr.net/gh/fgcy-333/gitnote-images/2023/5/16202305160122988.png" srcset="/img/loading.gif" lazyload alt="image-20230516012208343"></p>
<hr>
<p>关于mybatis的事务管理机制。（深度剖析）</p>
<p>在mybatis-config.xmL文件中,可以通过以下的配置进行mybatis的事务管理<code>&lt;transactionManager type=&quot;JDBC&quot;/&gt;</code></p>
<p>type属性的值包括两个：JDBC、MANAGED  type后面的值，只有以上两个值可选，不区分大小写。</p>
<p>在mybatis中提供了两种事务管理机制：</p>
<p>第一种：JDBC事务管理器</p>
<p>第二种：MANAGED事务管理器</p>
<p>JDBC事务管理器：</p>
<p>mybatis框架自己管理事务，自己采用原生的JDBC代码去管理事务</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-type">SqlSession</span> <span class="hljs-variable">sqlSession</span> <span class="hljs-operator">=</span> sqlSessionFactory.openSession(); <span class="hljs-comment">// 如果使用的事务管理器是JDBC的话,底层实际上会执行: conn.setAutoCommit(false);</span><br><span class="hljs-comment">//业务处理</span><br>sqlSession.commit();<span class="hljs-comment">//  如果使用的事务管理器是JDBC的话,底层实际上还是会执行conn.commit();</span><br></code></pre></td></tr></table></figure>





<p>将Connection对象的autoCommit设为false</p>
<hr>
<p><img src="https://cdn.jsdelivr.net/gh/fgcy-333/gitnote-images/2023/5/16202305160140683.png" srcset="/img/loading.gif" lazyload alt="image-20230516014042840"></p>
<hr>
<p>如果你编写的代码是下面的代码：<code>SqlSession sqlSession = sqlSessionFactory.openSession(true);</code>表示没有开启事务</p>
<p>因为这种方式压根不会执行：conn.setAutoCommit(false)</p>
<p>在JDBC事务中，没有执行conn.setAutoCommit(false);那么autoCommit就是true</p>
<p>如果autoCommit是true，就表示没有开启事务。只要执行任意一条DML语句就提交一次。</p>
<p>JDBC中的事务：如果你没有在JDBC代码中执行: conn.setAutoCommit(false);的话,默认的autoCommit是true</p>
<p>MANAGED事务管理器：</p>
<p>mybatis不再负责事务的管理了。即是没有事务。事务管理交给其它容器来负责。例如：spring</p>
<p>重点：以后注意了，只要你的autoCommit是true，就表示没有开启事务。只有你的autoCommit是false的时候，就表示开启了事务。</p>
<h2 id="2-6-引⼊JUnit"><a href="#2-6-引⼊JUnit" class="headerlink" title="2.6 引⼊JUnit"></a>2.6 引⼊JUnit</h2><p>JUnit是专⻔做单元测试的组件。 在实际开发中，单元测试⼀般是由我们Java程序员来完成的。 我们要对我们⾃⼰写的每⼀个业务⽅法负责任，要保证每个业务⽅法在进⾏测试的时候都能通 过</p>
<p>测试的过程中涉及到两个概念： 期望值 实际值 期望值和实际值相同表示测试通过，期望值和实际值不同则单元测试执⾏时会报错。</p>
<p>这⾥引⼊JUnit是为了代替main⽅法。 </p>
<p>使⽤JUnit步骤： 第⼀步：引⼊依赖</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-comment">&lt;!-- junit依赖 --&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>     <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>junit<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>     <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>junit<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>     <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>4.13.2<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br>     <span class="hljs-tag">&lt;<span class="hljs-name">scope</span>&gt;</span>test<span class="hljs-tag">&lt;/<span class="hljs-name">scope</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br></code></pre></td></tr></table></figure>



<p>第⼆步：编写单元测试类【测试⽤例】，测试⽤例中每⼀个测试⽅法上使⽤@Test注解进⾏标注。</p>
<p>测试⽤例的名字以及每个测试⽅法的定义都是有规范的： 测试⽤例的名字：XxxTest 测试⽅法声明格式：<code>public void test业务⽅法名()&#123;&#125;</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// 测试⽤例</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">CarMapperTest</span>&#123;<br><br> <span class="hljs-comment">// 测试⽅法</span><br> <span class="hljs-meta">@Test</span><br> <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">testInsert</span><span class="hljs-params">()</span>&#123;&#125;<br><br> <span class="hljs-meta">@Test</span><br> <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">testUpdate</span><span class="hljs-params">()</span>&#123;&#125;<br><br>&#125;<br></code></pre></td></tr></table></figure>



<p>第三步：可以在类上执⾏，也可以在⽅法上执⾏ 在类上执⾏时，该类中所有的测试⽅法都会执⾏。 在⽅法上执⾏时，只执⾏当前的测试⽅法。 编写⼀个测试⽤例，来测试insertCar业务:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.powernode.mybatis;<br><span class="hljs-keyword">import</span> org.apache.ibatis.io.Resources;<br><span class="hljs-keyword">import</span> org.apache.ibatis.session.SqlSession;<br><span class="hljs-keyword">import</span> org.apache.ibatis.session.SqlSessionFactory;<br><span class="hljs-keyword">import</span> org.apache.ibatis.session.SqlSessionFactoryBuilder;<br><span class="hljs-keyword">import</span> org.junit.Test;<br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">CarMapperTest</span> &#123;<br><br>    <span class="hljs-meta">@Test</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">testInsertCar</span><span class="hljs-params">()</span>&#123;<br>        <span class="hljs-type">SqlSession</span> <span class="hljs-variable">sqlSession</span> <span class="hljs-operator">=</span> <span class="hljs-literal">null</span>;<br>        <span class="hljs-keyword">try</span> &#123;<br>            <span class="hljs-comment">// 1.创建SqlSessionFactoryBuilder对象</span><br>            <span class="hljs-type">SqlSessionFactoryBuilder</span> <span class="hljs-variable">sqlSessionFactoryBuilder</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">SqlSes</span><br>            sionFactoryBuilder();<br>            <span class="hljs-comment">// 2.创建SqlSessionFactory对象</span><br>            <span class="hljs-type">SqlSessionFactory</span> <span class="hljs-variable">sqlSessionFactory</span> <span class="hljs-operator">=</span> sqlSessionFactoryBuilder<br>                    .build(Resources.getResourceAsStream(<span class="hljs-string">&quot;mybatis-config.xml&quot;</span>));<br>            <span class="hljs-comment">// 3.创建SqlSession对象</span><br>            sqlSession = sqlSessionFactory.openSession();<br>            <span class="hljs-comment">// 4.执⾏SQL</span><br>            <span class="hljs-type">int</span> <span class="hljs-variable">count</span> <span class="hljs-operator">=</span> sqlSession.insert(<span class="hljs-string">&quot;insertCar&quot;</span>);<br>            System.out.println(<span class="hljs-string">&quot;更新了⼏条记录：&quot;</span> + count);<br>            <span class="hljs-comment">// 5.提交</span><br>            sqlSession.commit();<br>        &#125; <span class="hljs-keyword">catch</span> (Exception e) &#123;<br>            <span class="hljs-comment">// 回滚</span><br>            <span class="hljs-keyword">if</span> (sqlSession != <span class="hljs-literal">null</span>) &#123;<br>                sqlSession.rollback();<br>            &#125;<br>            e.printStackTrace();<br>        &#125; <span class="hljs-keyword">finally</span> &#123;<br>            <span class="hljs-comment">// 6.关闭</span><br>            <span class="hljs-keyword">if</span> (sqlSession != <span class="hljs-literal">null</span>) &#123;<br>                sqlSession.close();<br>            &#125;<br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>执⾏单元测试，查看数据库表的变化：</p>
<hr>
<p><img src="https://cdn.jsdelivr.net/gh/fgcy-333/gitnote-images/2023/5/16202305181955104.png" srcset="/img/loading.gif" lazyload alt="image-20230518195501182"></p>
<hr>
<p>可以配合断言 判断结果：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">//加断言进行测试</span><br>Assert.assertEquals(expected, actual)<br></code></pre></td></tr></table></figure>







<h2 id="2-7-引⼊⽇志框架logback"><a href="#2-7-引⼊⽇志框架logback" class="headerlink" title="2.7 引⼊⽇志框架logback"></a>2.7 引⼊⽇志框架logback</h2><p>引⼊⽇志框架的⽬的是为了看清楚mybatis执⾏的具体sql。</p>
<p>启⽤标准⽇志组件，只需要在mybatis-config.xml⽂件中添加以下配置：【可参考mybatis⼿册】</p>
<p>mybatis-config.xml </p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">settings</span>&gt;</span><br> <span class="hljs-tag">&lt;<span class="hljs-name">setting</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;logImpl&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;STDOUT_LOGGING&quot;</span> /&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">settings</span>&gt;</span><br></code></pre></td></tr></table></figure>

<p>标准⽇志也可以⽤，但是配置不够灵活，可以集成其他的⽇志组件，例如：log4j，logback，log4j2等</p>
<p>slf4j一个日志标准,其中有一个框架叫做Logback,它实现了slf4j规范</p>
<p> logback是⽬前⽇志框架中性能较好的，较流⾏的，所以我们选它。 </p>
<blockquote>
<p>其中STDOUT-LOGGING是标准日志, mybatis已经实现了这种标准日志。mybatis框架本身已经实现了这种标准</p>
</blockquote>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">setting</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;LogImpl&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;STDOUT_LOGGING&quot;</span>/&gt;</span><br></code></pre></td></tr></table></figure>







<p>引⼊logback的步骤： 第⼀步：引⼊logback相关依赖</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br> <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>ch.qos.logback<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br> <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>logback-classic<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br> <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>1.2.11<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br> <span class="hljs-tag">&lt;<span class="hljs-name">scope</span>&gt;</span>test<span class="hljs-tag">&lt;/<span class="hljs-name">scope</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br></code></pre></td></tr></table></figure>

<p>第⼆步：引⼊logback相关配置⽂件（⽂件名叫做<code>logback.xml或logback-test.xml</code>，放到类路径 当中）</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-meta">&lt;?xml version=<span class="hljs-string">&quot;1.0&quot;</span> encoding=<span class="hljs-string">&quot;UTF-8&quot;</span>?&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">configuration</span> <span class="hljs-attr">debug</span>=<span class="hljs-string">&quot;false&quot;</span>&gt;</span><br>    <span class="hljs-comment">&lt;!--定义⽇志⽂件的存储地址--&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;LOG_HOME&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;/home&quot;</span>/&gt;</span><br>    <span class="hljs-comment">&lt;!-- 控制台输出 --&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">appender</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;STDOUT&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;ch.qos.logback.core.ConsoleAppender&quot;</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">encoder</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;ch.qos.logback.classic.encoder.PatternLayoutEncoder&quot;</span>&gt;</span><br>            <span class="hljs-comment">&lt;!--格式化输出：%d表示⽇期，%thread表示线程名，%-5level：级别从左显示5</span><br><span class="hljs-comment">           个字符宽度%msg：⽇志消息，%n是换⾏符--&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">pattern</span>&gt;</span>%d&#123;yyyy-MM-dd HH:mm:ss.SSS&#125; [%thread] %-5level %logge<br>                r&#123;50&#125; - %msg%n<span class="hljs-tag">&lt;/<span class="hljs-name">pattern</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">encoder</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">appender</span>&gt;</span><br>    <span class="hljs-comment">&lt;!-- 按照每天⽣成⽇志⽂件 --&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">appender</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;FILE&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;ch.qos.logback.core.rolling.RollingFileAppender&quot;</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">rollingPolicy</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;ch.qos.logback.core.rolling.TimeBasedRollingPolicy&quot;</span>&gt;</span><br>            <span class="hljs-comment">&lt;!--⽇志⽂件输出的⽂件名--&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">FileNamePattern</span>&gt;</span>$&#123;LOG_HOME&#125;/TestWeb.log.%d&#123;yyyy-MM-dd&#125;.log<span class="hljs-tag">&lt;/<span class="hljs-name">FileNamePattern</span>&gt;</span><br>            <span class="hljs-comment">&lt;!--⽇志⽂件保留天数--&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">MaxHistory</span>&gt;</span>30<span class="hljs-tag">&lt;/<span class="hljs-name">MaxHistory</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">rollingPolicy</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">encoder</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;ch.qos.logback.classic.encoder.PatternLayoutEncoder&quot;</span>&gt;</span><br>            <span class="hljs-comment">&lt;!--格式化输出：%d表示⽇期，%thread表示线程名，%-5level：级别从左显示5</span><br><span class="hljs-comment">           个字符宽度%msg：⽇志消息，%n是换⾏符--&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">pattern</span>&gt;</span>%d&#123;yyyy-MM-dd HH:mm:ss.SSS&#125; [%thread] %-5level %logge<br>                r&#123;50&#125; - %msg%n<span class="hljs-tag">&lt;/<span class="hljs-name">pattern</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">encoder</span>&gt;</span><br>        <span class="hljs-comment">&lt;!--⽇志⽂件最⼤的⼤⼩--&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">triggeringPolicy</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;ch.qos.logback.core.rolling.SizeBasedTriggeringPolicy&quot;</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">MaxFileSize</span>&gt;</span>100MB<span class="hljs-tag">&lt;/<span class="hljs-name">MaxFileSize</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">triggeringPolicy</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">appender</span>&gt;</span><br>    <span class="hljs-comment">&lt;!--mybatis log configure--&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">logger</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;com.apache.ibatis&quot;</span> <span class="hljs-attr">level</span>=<span class="hljs-string">&quot;TRACE&quot;</span>/&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">logger</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;java.sql.Connection&quot;</span> <span class="hljs-attr">level</span>=<span class="hljs-string">&quot;DEBUG&quot;</span>/&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">logger</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;java.sql.Statement&quot;</span> <span class="hljs-attr">level</span>=<span class="hljs-string">&quot;DEBUG&quot;</span>/&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">logger</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;java.sql.PreparedStatement&quot;</span> <span class="hljs-attr">level</span>=<span class="hljs-string">&quot;DEBUG&quot;</span>/&gt;</span><br>    <span class="hljs-comment">&lt;!-- ⽇志输出级别,logback⽇志级别包括五个：TRACE &lt; DEBUG &lt; INFO &lt; WARN &lt; ERROR --&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">root</span> <span class="hljs-attr">level</span>=<span class="hljs-string">&quot;DEBUG&quot;</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">appender-ref</span> <span class="hljs-attr">ref</span>=<span class="hljs-string">&quot;STDOUT&quot;</span>/&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">appender-ref</span> <span class="hljs-attr">ref</span>=<span class="hljs-string">&quot;FILE&quot;</span>/&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">root</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">configuration</span>&gt;</span><br></code></pre></td></tr></table></figure>

<p>再次执⾏单元测试⽅法testInsertCar，查看控制台是否有sql语句输出</p>
<hr>
<p><img src="https://cdn.jsdelivr.net/gh/fgcy-333/gitnote-images/2023/5/16202305181959643.png" srcset="/img/loading.gif" lazyload alt="image-20230518195904100"></p>
<hr>
<p>日志框架,有依赖 有配置文件即可 无需在mybatis中配置</p>
<h2 id="2-8-MyBatis⼯具类SqlSessionUtil的封装"><a href="#2-8-MyBatis⼯具类SqlSessionUtil的封装" class="headerlink" title="2.8 MyBatis⼯具类SqlSessionUtil的封装"></a>2.8 MyBatis⼯具类SqlSessionUtil的封装</h2><p>每⼀次获取SqlSession对象代码太繁琐，封装⼀个⼯具类</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.powernode.mybatis.utils;<br><span class="hljs-keyword">import</span> org.apache.ibatis.io.Resources;<br><span class="hljs-keyword">import</span> org.apache.ibatis.session.SqlSession;<br><span class="hljs-keyword">import</span> org.apache.ibatis.session.SqlSessionFactory;<br><span class="hljs-keyword">import</span> org.apache.ibatis.session.SqlSessionFactoryBuilder;<br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">SqlSessionUtil</span> &#123;<br>   <br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> SqlSessionFactory sqlSessionFactory;<br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * 类加载时初始化sqlSessionFactory对象</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-comment">//SalSessionFactorv对象:一个SalSessionFactory对应一个environment,一个environment通常是一个数据库</span><br>    <span class="hljs-keyword">static</span> &#123;<br>        <span class="hljs-keyword">try</span> &#123;<br>            <span class="hljs-type">SqlSessionFactoryBuilder</span> <span class="hljs-variable">sqlSessionFactoryBuilder</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">SqlSes</span><br>            sionFactoryBuilder();<br>            sqlSessionFactory = sqlSessionFactoryBuilder.build(Resources.g<br>                    <span class="hljs-title function_">etResourceAsStream</span><span class="hljs-params">(<span class="hljs-string">&quot;mybatis-config.xml&quot;</span>)</span>);<br>        &#125; <span class="hljs-keyword">catch</span> (Exception e) &#123;<br>            e.printStackTrace();<br>        &#125;<br>    &#125;<br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * 每调⽤⼀次openSession()可获取⼀个新的会话，该会话⽀持⾃动提交。</span><br><span class="hljs-comment">     *</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span> 新的会话对象</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> SqlSession <span class="hljs-title function_">openSession</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> sqlSessionFactory.openSession(<span class="hljs-literal">true</span>);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>





<p>测试代码：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Test</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">testInsertCar</span><span class="hljs-params">()</span>&#123;<br>     <span class="hljs-type">SqlSession</span> <span class="hljs-variable">sqlSession</span> <span class="hljs-operator">=</span> SqlSessionUtil.openSession();<br>     <span class="hljs-comment">// 执⾏SQL</span><br>     <span class="hljs-type">int</span> <span class="hljs-variable">count</span> <span class="hljs-operator">=</span> sqlSession.insert(<span class="hljs-string">&quot;insertCar&quot;</span>);<br>     System.out.println(<span class="hljs-string">&quot;插⼊了⼏条记录:&quot;</span> + count);<br>     sqlSession.close();<br>&#125;<br></code></pre></td></tr></table></figure>











<h1 id="三、使⽤MyBatis完成CRUD"><a href="#三、使⽤MyBatis完成CRUD" class="headerlink" title="三、使⽤MyBatis完成CRUD"></a>三、使⽤MyBatis完成CRUD</h1><p>准备⼯作 创建module（Maven的普通Java模块）：mybatis-002-crud </p>
<p>pom.xml 文件准备</p>
<ul>
<li>打包⽅式jar</li>
</ul>
<p>依赖： </p>
<ul>
<li>mybatis依赖 </li>
<li>mysql驱动依赖 </li>
<li>junit依赖 </li>
<li>logback依赖</li>
</ul>
<hr>
<p>mybatis-config.xml放在类的根路径下 </p>
<p>CarMapper.xml放在类的根路径下 </p>
<p>logback.xml放在类的根路径下 </p>
<p>提供com.powernode.mybatis.utils.SqlSessionUtil⼯具类 </p>
<p>创建测试⽤例：com.powernode.mybatis.CarMapperTest</p>
<h2 id="3-1-insert（Create）"><a href="#3-1-insert（Create）" class="headerlink" title="3.1 insert（Create）"></a>3.1 insert（Create）</h2><h5 id="集合map传值"><a href="#集合map传值" class="headerlink" title="集合map传值"></a>集合map传值</h5><p>CarMapper.xml</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-meta">&lt;?xml version=<span class="hljs-string">&quot;1.0&quot;</span> encoding=<span class="hljs-string">&quot;UTF-8&quot;</span> ?&gt;</span><br><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">mapper</span></span><br><span class="hljs-meta"> <span class="hljs-keyword">PUBLIC</span> <span class="hljs-string">&quot;-//mybatis.org//DTD Mapper 3.0//EN&quot;</span></span><br><span class="hljs-meta"> <span class="hljs-string">&quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;</span>&gt;</span><br><span class="hljs-comment">&lt;!--namespace先随便写--&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">mapper</span> <span class="hljs-attr">namespace</span>=<span class="hljs-string">&quot;car&quot;</span>&gt;</span><br> <span class="hljs-tag">&lt;<span class="hljs-name">insert</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;insertCar&quot;</span>&gt;</span><br> insert into t_car(car_num,brand,guide_price,produce_time,car_type) values(#&#123;k1&#125;,#&#123;k2&#125;,#&#123;k3&#125;,#&#123;k4&#125;,#&#123;k5&#125;)<br> <span class="hljs-tag">&lt;/<span class="hljs-name">insert</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">mapper</span>&gt;</span><br></code></pre></td></tr></table></figure>

<p>在MyBatis中可以这样做： 在Java程序中，将数据放到Map集合中 在sql语句中使⽤ #{map集合的key} 来完成传值、</p>
<p>#{} 等同于JDBC中的 ? ，#{}就是占位符</p>
<p>#{} 的⾥⾯必须填写map集合的key，不能随便写。 因为底层调用的是 map.get(key);方法；一般map集合的key起名的时候要见名知意</p>
<p>测试代码：CarMapperTest.testInsertCar()</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.powernode.mybatis;<br><span class="hljs-keyword">import</span> com.powernode.mybatis.utils.SqlSessionUtil;<br><span class="hljs-keyword">import</span> org.apache.ibatis.session.SqlSession;<br><span class="hljs-keyword">import</span> org.junit.Test;<br><span class="hljs-keyword">import</span> java.util.HashMap;<br><span class="hljs-keyword">import</span> java.util.Map;<br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">CarMapperTest</span> &#123;<br>    <span class="hljs-meta">@Test</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">testInsertCar</span><span class="hljs-params">()</span>&#123;<br>        <span class="hljs-comment">// 准备数据</span><br>        Map&lt;String, Object&gt; map = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>&lt;&gt;();<br>        map.put(<span class="hljs-string">&quot;k1&quot;</span>, <span class="hljs-string">&quot;103&quot;</span>);<br>        map.put(<span class="hljs-string">&quot;k2&quot;</span>, <span class="hljs-string">&quot;奔驰E300L&quot;</span>);<br>        map.put(<span class="hljs-string">&quot;k3&quot;</span>, <span class="hljs-number">50.3</span>);<br>        map.put(<span class="hljs-string">&quot;k4&quot;</span>, <span class="hljs-string">&quot;2020-10-01&quot;</span>);<br>        map.put(<span class="hljs-string">&quot;k5&quot;</span>, <span class="hljs-string">&quot;燃油⻋&quot;</span>);<br>        <span class="hljs-comment">// 获取SqlSession对象</span><br>        <span class="hljs-type">SqlSession</span> <span class="hljs-variable">sqlSession</span> <span class="hljs-operator">=</span> SqlSessionUtil.openSession();<br>        <span class="hljs-comment">// 执⾏SQL语句（使⽤map集合给sql语句传递数据）</span><br>        <span class="hljs-type">int</span> <span class="hljs-variable">count</span> <span class="hljs-operator">=</span> sqlSession.insert(<span class="hljs-string">&quot;insertCar&quot;</span>, map);<br>        System.out.println(<span class="hljs-string">&quot;插⼊了⼏条记录：&quot;</span> + count);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<h5 id="对象传值："><a href="#对象传值：" class="headerlink" title="对象传值："></a>对象传值：</h5><p>使⽤Map集合可以传参，那使⽤pojo（简单普通的java对象）可以完成传参吗？测试⼀下：</p>
<p>第⼀步：定义⼀个pojo类Car，提供相关属性。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br></pre></td><td class="code"><pre><code class="hljs 。java">public class Car &#123;<br>    private Long id;<br>    private String carNum;<br>    private String brand;<br>    private Double guidePrice;<br>    private String produceTime;<br>    private String carType;<br>    @Override<br>    public String toString() &#123;<br>        return &quot;Car&#123;&quot; +<br>                &quot;id=&quot; + id +<br>                &quot;, carNum=&#x27;&quot; + carNum + &#x27;\&#x27;&#x27; +<br>                &quot;, brand=&#x27;&quot; + brand + &#x27;\&#x27;&#x27; +<br>                &quot;, guidePrice=&quot; + guidePrice +<br>                &quot;, produceTime=&#x27;&quot; + produceTime + &#x27;\&#x27;&#x27; +<br>                &quot;, carType=&#x27;&quot; + carType + &#x27;\&#x27;&#x27; +<br>                &#x27;&#125;&#x27;;<br>    &#125;<br>    public Car() &#123;<br>        <br>    &#125;<br>    public Car(Long id, String carNum, String brand, Double guidePrice, String produceTime, String carType) &#123;<br>        this.id = id;<br>        this.carNum = carNum;<br>        this.brand = brand;<br>        this.guidePrice = guidePrice;<br>        this.produceTime = produceTime;<br>        this.carType = carType;<br>    &#125;<br>    public Long getId() &#123;<br>        return id;<br>    &#125;<br>    public void setId(Long id) &#123;<br>        this.id = id;<br><br>    &#125;<br>    public String getCarNum() &#123;<br>        return carNum;<br><br>    &#125;<br>    public String getBrand() &#123;<br>        return brand;<br><br>    &#125;<br>    public void setCarNum(String carNum )    &#123;<br>        this.carNum = carNum;<br><br>    &#125;<br>    public void setBrand(String brand)<br>    &#123;<br>        this.brand = brand;<br><br>    &#125;<br>    public Double getGuidePrice() &#123;<br>        return guidePrice;<br><br>    &#125;<br>    public void setGuidePrice(Double guidePrice) &#123;<br>        this.guidePrice = guidePrice;<br><br>    &#125;<br>    public String getProduceTime() &#123;<br>        return produceTime;<br>    &#125;<br>    public void setProduceTime(String produceTime)&#123;<br>        this.produceTime = produceTime;<br><br>    &#125;<br>    public String getCarType() &#123;<br>        return carType;<br><br>    &#125;<br>    public void setCarType(String carType) &#123;<br>        this.carType = carType;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<blockquote>
<p>数据库表当中的字段应该和pojo类的属性一一对应</p>
<p>建议使用包装类，这样可以防止null的问题</p>
</blockquote>
<p>第 ⼆ 步：J a v a 程 序</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Test</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">testInsertCarByPOJO</span><span class="hljs-params">()</span>&#123;<br>        <span class="hljs-comment">// 创建POJO，封装数据</span><br>        <span class="hljs-type">Car</span> <span class="hljs-variable">car</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Car</span>();<br>        car.setCarNum(<span class="hljs-string">&quot;103&quot;</span>);<br>        car.setBrand(<span class="hljs-string">&quot;奔驰C200&quot;</span>);<br>        car.setGuidePrice(<span class="hljs-number">33.23</span>);<br>        car.setProduceTime(<span class="hljs-string">&quot;2020-10-11&quot;</span>);<br>        car.setCarType(<span class="hljs-string">&quot;燃油⻋&quot;</span>);<br>        <span class="hljs-comment">// 获取SqlSession对象</span><br>        <span class="hljs-type">SqlSession</span> <span class="hljs-variable">sqlSession</span> <span class="hljs-operator">=</span> SqlSessionUtil.openSession();<br>        <span class="hljs-comment">// 执⾏SQL，传数据</span><br>        <span class="hljs-type">int</span> <span class="hljs-variable">count</span> <span class="hljs-operator">=</span> sqlSession.insert(<span class="hljs-string">&quot;insertCarByPOJO&quot;</span>, car);<br>        System.out.println(<span class="hljs-string">&quot;插⼊了⼏条记录&quot;</span> + count);<br>  &#125;<br></code></pre></td></tr></table></figure>



<p>第三步：SQL语句</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">insert</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;insertCarByPOJO&quot;</span>&gt;</span><br> <span class="hljs-comment">&lt;!--#&#123;&#125; ⾥写的是POJO的属性名--&gt;</span><br> insert into t_car(car_num,brand,guide_price,produce_time,car_type) values(#&#123;carNum&#125;,#&#123;brand&#125;,#&#123;guidePrice&#125;,#&#123;produceTime&#125;,#&#123;carType&#125;)<br><span class="hljs-tag">&lt;/<span class="hljs-name">insert</span>&gt;</span><br></code></pre></td></tr></table></figure>

<blockquote>
<p>#{}严格意义上写的不是属性名 而是写的是get方法的方法名去掉get，然后将剩下的单词首字母小写，然后放进去</p>
</blockquote>
<p>运⾏程序，查看数据库表：</p>
<hr>
<p><img src="https://cdn.jsdelivr.net/gh/fgcy-333/gitnote-images/2023/5/16202305182042567.png" srcset="/img/loading.gif" lazyload alt="image-20230518204206840"></p>
<hr>
<p>注意：其实传参数的时候有⼀个属性parameterType，这个属性⽤来指定传参的数据类型，不过这个属 性是可以省略的</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">insert</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;insertCar&quot;</span> <span class="hljs-attr">parameterType</span>=<span class="hljs-string">&quot;java.util.Map&quot;</span>&gt;</span><br> insert into t_car(car_num,brand,guide_price,produce_time,car_type) values<br>(#&#123;carNum&#125;,#&#123;brand&#125;,#&#123;guidePrice&#125;,#&#123;produceTime&#125;,#&#123;carType&#125;)<br><span class="hljs-tag">&lt;/<span class="hljs-name">insert</span>&gt;</span><br><br><span class="hljs-tag">&lt;<span class="hljs-name">insert</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;insertCarByPOJO&quot;</span> <span class="hljs-attr">parameterType</span>=<span class="hljs-string">&quot;com.powernode.mybatis.pojo.Car&quot;</span>&gt;</span><br> insert into t_car(car_num,brand,guide_price,produce_time,car_type) values(#&#123;carNum&#125;,#&#123;brand&#125;,#&#123;guidePrice&#125;,#&#123;produceTime&#125;,#&#123;carType&#125;)<br><span class="hljs-tag">&lt;/<span class="hljs-name">insert</span>&gt;</span><br></code></pre></td></tr></table></figure>









<h2 id="3-2-delete（Delete）"><a href="#3-2-delete（Delete）" class="headerlink" title="3.2 delete（Delete）"></a>3.2 delete（Delete）</h2><p>需求：根据car_num进⾏删除。 SQL语句这样写：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">delete</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;deleteByCarNum&quot;</span>&gt;</span><br>     delete from t_car where car_num = #&#123;SuiBianXie&#125;<br><span class="hljs-tag">&lt;/<span class="hljs-name">delete</span>&gt;</span><br></code></pre></td></tr></table></figure>

<p>Java程序这样写：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Test</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">testDeleteByCarNum</span><span class="hljs-params">()</span>&#123;<br>     <span class="hljs-comment">// 获取SqlSession对象</span><br>     <span class="hljs-type">SqlSession</span> <span class="hljs-variable">sqlSession</span> <span class="hljs-operator">=</span> SqlSessionUtil.openSession();<br>     <span class="hljs-comment">// 执⾏SQL语句</span><br>     <span class="hljs-type">int</span> <span class="hljs-variable">count</span> <span class="hljs-operator">=</span> sqlSession.delete(<span class="hljs-string">&quot;deleteByCarNum&quot;</span>, <span class="hljs-string">&quot;102&quot;</span>);<br>     System.out.println(<span class="hljs-string">&quot;删除了⼏条记录：&quot;</span> + count);<br>&#125;<br></code></pre></td></tr></table></figure>

<p>注意：如果占位符只有一个，那么#仔的大括号里可以随意。但是最好见名知意。</p>
<h2 id="3-3-update（Update）"><a href="#3-3-update（Update）" class="headerlink" title="3.3 update（Update）"></a>3.3 update（Update）</h2><p>需求：修改id&#x3D;34的Car信息，car_num为102，brand为⽐亚迪汉，guide_price为30.23，produce_time 为2018-09-10，car_type为电⻋ 修改前：</p>
<hr>
<p><img src="https://cdn.jsdelivr.net/gh/fgcy-333/gitnote-images/2023/5/16202305182049405.png" srcset="/img/loading.gif" lazyload alt="image-20230518204922335"></p>
<hr>
<p>SQL语句如下：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">update</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;updateCarByPOJO&quot;</span>&gt;</span><br>     update t_car set<br>     car_num = #&#123;carNum&#125;, brand = #&#123;brand&#125;,<br>     guide_price = #&#123;guidePrice&#125;, produce_time = #&#123;produceTime&#125;,<br>     car_type = #&#123;carType&#125;<br>     where id = #&#123;id&#125;<br><span class="hljs-tag">&lt;/<span class="hljs-name">update</span>&gt;</span><br></code></pre></td></tr></table></figure>



<p>Java代码如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Test</span><br> <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">testUpdateCarByPOJO</span><span class="hljs-params">()</span>&#123;<br>     <span class="hljs-comment">// 准备数据</span><br>     <span class="hljs-type">Car</span> <span class="hljs-variable">car</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Car</span>();<br>     car.setId(<span class="hljs-number">34L</span>);<br>     car.setCarNum(<span class="hljs-string">&quot;102&quot;</span>);<br>     car.setBrand(<span class="hljs-string">&quot;⽐亚迪汉&quot;</span>);<br>     car.setGuidePrice(<span class="hljs-number">30.23</span>);<br>     car.setProduceTime(<span class="hljs-string">&quot;2018-09-10&quot;</span>);<br>     car.setCarType(<span class="hljs-string">&quot;电⻋&quot;</span>);<br>     <span class="hljs-comment">// 获取SqlSession对象</span><br>     <span class="hljs-type">SqlSession</span> <span class="hljs-variable">sqlSession</span> <span class="hljs-operator">=</span> SqlSessionUtil.openSession();<br>     <span class="hljs-comment">// 执⾏SQL语句</span><br>     <span class="hljs-type">int</span> <span class="hljs-variable">count</span> <span class="hljs-operator">=</span> sqlSession.update(<span class="hljs-string">&quot;updateCarByPOJO&quot;</span>, car);<br>     System.out.println(<span class="hljs-string">&quot;更新了⼏条记录：&quot;</span> + count);<br> &#125;<br></code></pre></td></tr></table></figure>

<blockquote>
<p>当然了，如果使⽤map传数据也是可以的。</p>
</blockquote>
<h2 id="3-4-select（Retrieve）"><a href="#3-4-select（Retrieve）" class="headerlink" title="3.4 select（Retrieve）"></a>3.4 select（Retrieve）</h2><p>select语句和其它语句不同的是：查询会有⼀个结果集。来看mybatis是怎么处理结果集的！！！</p>
<p>查询⼀条数据  需求：查询id为1的Car信息 SQL语句如下：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">select</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;selectCarById&quot;</span>&gt;</span><br> select * from t_car where id = #&#123;id&#125;<br><span class="hljs-tag">&lt;/<span class="hljs-name">select</span>&gt;</span><br></code></pre></td></tr></table></figure>



<p>Java程序如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Test</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">testSelectCarById</span><span class="hljs-params">()</span>&#123;<br>     <span class="hljs-comment">// 获取SqlSession对象</span><br>     <span class="hljs-type">SqlSession</span> <span class="hljs-variable">sqlSession</span> <span class="hljs-operator">=</span> SqlSessionUtil.openSession();<br>     <span class="hljs-comment">// 执⾏SQL语句 类型可以用Car</span><br>     <span class="hljs-type">Object</span> <span class="hljs-variable">car</span> <span class="hljs-operator">=</span> sqlSession.selectOne(<span class="hljs-string">&quot;selectCarById&quot;</span>, <span class="hljs-number">1</span>);<br>     System.out.println(car);<br>&#125;<br></code></pre></td></tr></table></figure>

<p>运⾏结果如下：</p>
<hr>
<p><img src="https://cdn.jsdelivr.net/gh/fgcy-333/gitnote-images/2023/5/16202305182056956.png" srcset="/img/loading.gif" lazyload alt="image-20230518205657978"></p>
<p>很可能既没有指定结果类型，也没有指定结果映射</p>
<hr>
<blockquote>
<p>以上的异常⼤致的意思是：对于⼀个查询语句来说，你需要指定它的“结果类型”或者“结果映射”</p>
<p>所以说，你想让mybatis查询之后返回⼀个Java对象的话，⾄少你要告诉mybatis返回⼀个什么类型的 Java对象</p>
</blockquote>
<p>可以在标签中添加resultType属性，⽤来指定查询要转换的类型</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">select</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;selectCarById&quot;</span> <span class="hljs-attr">resultType</span>=<span class="hljs-string">&quot;com.powernode.mybatis.pojo.Car&quot;</span>&gt;</span><br> select * from t_car where id = #&#123;id&#125;<br><span class="hljs-tag">&lt;/<span class="hljs-name">select</span>&gt;</span><br></code></pre></td></tr></table></figure>

<p>运⾏结果：</p>
<hr>
<p><img src="https://cdn.jsdelivr.net/gh/fgcy-333/gitnote-images/2023/5/16202305182059816.png" srcset="/img/loading.gif" lazyload alt="image-20230518205925761"></p>
<hr>
<p>运⾏后之前的异常不再出现了，这说明添加了resultType属性之后，解决了之前的异常，可以看出 resultType是不能省略的</p>
<p>仔细观察控制台的⽇志信息，不难看出，结果查询出了⼀条</p>
<p>并且每个字段都查询到值了：Row: 1, 100, 宝⻢520Li, 41.00, 2022-09-01, 燃油⻋ 但是奇怪的是返回的Car对象，只有id和brand两个属性有值，其它属性的值都是null，这是为什么呢？</p>
<p>我 们来观察⼀下查询结果列名和Car类的属性名是否能⼀⼀对应： </p>
<p>查询结果集的列名：id, car_num, brand, guide_price, produce_time, car_type </p>
<p>Car类的属性名：id, carNum, brand, guidePrice, produceTime, carType</p>
<p>通过观察发现：只有id和brand是⼀致的，其他字段名和属性名对应不上，这是不是导致null的原因呢？ </p>
<p>我们尝试在sql语句中使⽤as关键字来给查询结果列名起别名试试：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">select</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;selectCarById&quot;</span> <span class="hljs-attr">resultType</span>=<span class="hljs-string">&quot;com.powernode.mybatis.pojo.Car&quot;</span>&gt;</span><br> select id, car_num as carNum, brand, guide_price as guidePrice, produce_time as produceTime, car_type as carType<br> from t_car<br> where id = #&#123;id&#125;<br><span class="hljs-tag">&lt;/<span class="hljs-name">select</span>&gt;</span><br></code></pre></td></tr></table></figure>

<hr>
<p><img src="https://cdn.jsdelivr.net/gh/fgcy-333/gitnote-images/2023/5/16202305182101278.png" srcset="/img/loading.gif" lazyload alt="image-20230518210122258"></p>
<hr>
<blockquote>
<p>通过测试得知，如果当查询结果的字段名和java类的属性名对应不上的话，可以采⽤as关键字起别名， 当然还有其它解决⽅案，我们后⾯再看。</p>
</blockquote>
<p><strong>查询多条数据</strong></p>
<p>需求：查询所有的Car信息。 SQL语句如下：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-comment">&lt;!--虽然结果是List集合，但是resultType属性需要指定的是List集合中元素的类型。--&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">select</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;selectCarAll&quot;</span> <span class="hljs-attr">resultType</span>=<span class="hljs-string">&quot;com.powernode.mybatis.pojo.Car&quot;</span>&gt;</span><br> <span class="hljs-comment">&lt;!--记得使⽤as起别名，让查询结果的字段名和java类的属性名对应上。--&gt;</span><br> select<br> id, car_num as carNum, brand, guide_price as guidePrice, produce_time as produceTime, car_type as carType<br> from  t_car<br><span class="hljs-tag">&lt;/<span class="hljs-name">select</span>&gt;</span><br></code></pre></td></tr></table></figure>

<p>Java代码如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Test</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">testSelectCarAll</span><span class="hljs-params">()</span>&#123;<br>     <span class="hljs-comment">// 获取SqlSession对象</span><br>     <span class="hljs-type">SqlSession</span> <span class="hljs-variable">sqlSession</span> <span class="hljs-operator">=</span> SqlSessionUtil.openSession();<br>     <span class="hljs-comment">// 执⾏SQL语句 泛型用Car也可以</span><br>     List&lt;Object&gt; cars = sqlSession.selectList(<span class="hljs-string">&quot;selectCarAll&quot;</span>);<br>     <span class="hljs-comment">// 输出结果</span><br>     cars.forEach(car -&gt; System.out.println(car));<br>&#125;<br></code></pre></td></tr></table></figure>

<hr>
<p><img src="https://cdn.jsdelivr.net/gh/fgcy-333/gitnote-images/2023/5/16202305182103846.png" srcset="/img/loading.gif" lazyload alt="image-20230518210300088"></p>
<hr>
<blockquote>
<p>注意：</p>
<p>resultType还是指定要封装的结果集的类型。不是指定List类型，是指定List集合中元素的类型</p>
<p>selectList方法：mybatis通过这个方法就可以得知你需要一个List集合。它会自动给你返回一个List集合。</p>
</blockquote>
<h2 id="3-5-关于SQL-Mapper的namespace"><a href="#3-5-关于SQL-Mapper的namespace" class="headerlink" title="3.5 关于SQL Mapper的namespace"></a>3.5 关于SQL Mapper的namespace</h2><p>在SQL Mapper配置⽂件中标签的namespace属性可以翻译为命名空间，这个命名空间主要是 为了防⽌sqlId冲突的。 </p>
<p>创建CarMapper2.xml⽂件，代码如下：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-meta">&lt;?xml version=<span class="hljs-string">&quot;1.0&quot;</span> encoding=<span class="hljs-string">&quot;UTF-8&quot;</span> ?&gt;</span><br><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">mapper</span></span><br><span class="hljs-meta"> <span class="hljs-keyword">PUBLIC</span> <span class="hljs-string">&quot;-//mybatis.org//DTD Mapper 3.0//EN&quot;</span></span><br><span class="hljs-meta"> <span class="hljs-string">&quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">mapper</span> <span class="hljs-attr">namespace</span>=<span class="hljs-string">&quot;car2&quot;</span>&gt;</span><br> <span class="hljs-tag">&lt;<span class="hljs-name">select</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;selectCarAll&quot;</span> <span class="hljs-attr">resultType</span>=<span class="hljs-string">&quot;com.powernode.mybatis.pojo.Car&quot;</span>&gt;</span><br> select<br> id, car_num as carNum, brand, guide_price as guidePrice, produce_time as produceTime, car_type as carType<br> from t_car<br> <span class="hljs-tag">&lt;/<span class="hljs-name">select</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">mapper</span>&gt;</span><br></code></pre></td></tr></table></figure>





<p>不难看出，CarMapper.xml和CarMapper2.xml⽂件中都有 id&#x3D;”selectCarAll”</p>
<p>将CarMapper2.xml配置到mybatis-config.xml⽂件中。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">mappers</span>&gt;</span><br> <span class="hljs-tag">&lt;<span class="hljs-name">mapper</span> <span class="hljs-attr">resource</span>=<span class="hljs-string">&quot;CarMapper.xml&quot;</span>/&gt;</span><br> <span class="hljs-tag">&lt;<span class="hljs-name">mapper</span> <span class="hljs-attr">resource</span>=<span class="hljs-string">&quot;CarMapper2.xml&quot;</span>/&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">mappers</span>&gt;</span><br></code></pre></td></tr></table></figure>

<p>编写Java代码如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Test</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">testNamespace</span><span class="hljs-params">()</span>&#123;<br>     <span class="hljs-comment">// 获取SqlSession对象</span><br>     <span class="hljs-type">SqlSession</span> <span class="hljs-variable">sqlSession</span> <span class="hljs-operator">=</span> SqlSessionUtil.openSession();<br>     <span class="hljs-comment">// 执⾏SQL语句</span><br>     List&lt;Object&gt; cars = sqlSession.selectList(<span class="hljs-string">&quot;selectCarAll&quot;</span>);<br>     <span class="hljs-comment">// 输出结果</span><br>     cars.forEach(car -&gt; System.out.println(car));<br>&#125;<br></code></pre></td></tr></table></figure>



<p>运⾏报错结果如下：</p>
<hr>
<p><img src="https://cdn.jsdelivr.net/gh/fgcy-333/gitnote-images/2023/5/16202305182107923.png" srcset="/img/loading.gif" lazyload alt="image-20230518210711535"></p>
<hr>
<blockquote>
<p>正确完整的写法：namespace. id</p>
</blockquote>
<h1 id="四、MyBatis核⼼配置⽂件详解"><a href="#四、MyBatis核⼼配置⽂件详解" class="headerlink" title="四、MyBatis核⼼配置⽂件详解"></a>四、MyBatis核⼼配置⽂件详解</h1><p>mybatis-config.xml</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-meta">&lt;?xml version=<span class="hljs-string">&quot;1.0&quot;</span> encoding=<span class="hljs-string">&quot;UTF-8&quot;</span> ?&gt;</span><br><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">configuration</span></span><br><span class="hljs-meta"> <span class="hljs-keyword">PUBLIC</span> <span class="hljs-string">&quot;-//mybatis.org//DTD Config 3.0//EN&quot;</span></span><br><span class="hljs-meta"> <span class="hljs-string">&quot;http://mybatis.org/dtd/mybatis-3-config.dtd&quot;</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">configuration</span>&gt;</span><br> <span class="hljs-tag">&lt;<span class="hljs-name">environments</span> <span class="hljs-attr">default</span>=<span class="hljs-string">&quot;development&quot;</span>&gt;</span><br>     <span class="hljs-tag">&lt;<span class="hljs-name">environment</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;development&quot;</span>&gt;</span><br>     <span class="hljs-tag">&lt;<span class="hljs-name">transactionManager</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;JDBC&quot;</span>/&gt;</span><br>     <span class="hljs-tag">&lt;<span class="hljs-name">dataSource</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;POOLED&quot;</span>&gt;</span><br>     <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;driver&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;com.mysql.cj.jdbc.Driver&quot;</span>/&gt;</span><br>     <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;url&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;jdbc:mysql://localhost:3306/powernode&quot;</span>/&gt;</span><br>     <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;username&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;root&quot;</span>/&gt;</span><br>     <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;password&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;root&quot;</span>/&gt;</span><br>     <span class="hljs-tag">&lt;/<span class="hljs-name">dataSource</span>&gt;</span><br>     <span class="hljs-tag">&lt;/<span class="hljs-name">environment</span>&gt;</span><br> <span class="hljs-tag">&lt;/<span class="hljs-name">environments</span>&gt;</span><br> <span class="hljs-tag">&lt;<span class="hljs-name">mappers</span>&gt;</span><br>     <span class="hljs-tag">&lt;<span class="hljs-name">mapper</span> <span class="hljs-attr">resource</span>=<span class="hljs-string">&quot;CarMapper.xml&quot;</span>/&gt;</span><br>     <span class="hljs-tag">&lt;<span class="hljs-name">mapper</span> <span class="hljs-attr">resource</span>=<span class="hljs-string">&quot;CarMapper2.xml&quot;</span>/&gt;</span><br> <span class="hljs-tag">&lt;/<span class="hljs-name">mappers</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">configuration</span>&gt;</span><br></code></pre></td></tr></table></figure>

<ul>
<li><p>configuration：根标签，表示配置信息</p>
</li>
<li><p>environments：环境（多个），以“s”结尾表示复数，也就是说mybatis的环境可以配置多个数据 源</p>
<ul>
<li>default属性：表示默认使⽤的是哪个环境，default后⾯填写的是environment的iddefault的 值只需要和environment的id值⼀致即可</li>
</ul>
</li>
<li><p>environment：具体的环境配置（主要包括：事务管理器的配置 + 数据源的配置） </p>
<ul>
<li>id：给当前环境⼀个唯⼀标识，该标识⽤在environments的default后⾯，⽤来指定默认环境的 选择</li>
</ul>
</li>
<li><p>transactionManager：配置事务管理器</p>
</li>
<li><p>type属性：指定事务管理器具体使⽤什么⽅式，可选值包括两个 </p>
<ul>
<li>JDBC：使⽤JDBC原⽣的事务管理机制。底层原理：事务开启 conn.setAutoCommit(false); …处理业务…事务提交conn.commit();</li>
<li>MANAGED：交给其它容器来管理事务，⽐如WebLogic、JBOSS等。<strong>如果没有管理事务的容器，则没有事务。没有事务的含义：只要执⾏⼀条DML语句，则提交⼀次。</strong> </li>
<li>如果<code>type=&quot;JDBC&quot;</code>，那么底层会实例化JdbcTransaction对象。如果<code>type=&quot;MANAGED&quot;</code>，那么底层会实例化ManagedTransaction</li>
</ul>
</li>
<li><p>dataSource：指定数据源  为程序提供Connection对象的叫数据源    <strong>数据源实际上是一套规范。JDK中有这套规范：javax.sql.DataSource</strong></p>
<p>我们自己也可以编写数据源组件，只要实现javax.sqL.DataSource接口就行了。实现接口当中所有的方法。这样就有了自己的数据源。比如你可以写一个属于自己的数据库连接池（数据库连接池是提供连接对象的，所以数据库连接池就是一个数据源）</p>
<ul>
<li>type属性：⽤来指定具体使⽤的数据库连接池的策略，可选值包括三个 <ul>
<li>UNPOOLED：采⽤传统的获取连接的⽅式，虽然也实现Javax.sql.DataSource接⼝，但是 并没有使⽤池的思想。每一次请求过来之后，都是创建新的Connection对象 <ul>
<li>property可以是： <ul>
<li>driver 这是 JDBC 驱动的 Java 类全限定名。 </li>
<li>url 这是数据库的 JDBC URL 地址。 </li>
<li>username 登录数据库的⽤户名。 </li>
<li>password 登录数据库的密码。 </li>
<li>defaultTransactionIsolationLevel 默认的连接事务隔离级别。 </li>
<li>defaultNetworkTimeout 等待数据库操作完成的默认⽹络超时时间（单位：毫秒）</li>
</ul>
</li>
</ul>
</li>
<li>POOLED：采⽤传统的javax.sql.DataSource规范中的连接池，mybatis中有针对规范的实 现。 </li>
<li>property可以是（除了包含UNPOOLED中之外）： <ul>
<li>poolMaximumActiveConnections 在任意时间可存在的活动（正在使⽤）连接数 量，默认值：10 </li>
<li>poolMaximumIdleConnections 任意时间可能存在的空闲连接数。 </li>
<li>其它….</li>
</ul>
</li>
<li>JNDI：集成其它第三方的数据库连接池。如果不是web或者maven的war⼯程，JNDI是不能使⽤的。JNDI是一套规范。谁实现了这套规范呢？大部分的web容器都实现了JNDI规范：例如：Tomcat、Jetty、WebLogic、WebSphere，这些服务器（容器)都实现了JNDI规范。JNDI是：java命名目录接口。Tomcat服务器实现了这个规范。<ul>
<li>property可以是（最多只包含以下两个属性）：</li>
<li>initial_context 这个属性⽤来在 InitialContext 中寻找上下⽂（即， initialContext.lookup(initial_context)）这是个可选属性，如果忽略，那么将会直接从 InitialContext 中寻找 data_source 属性</li>
<li>data_source 这是引⽤数据源实例位置的上下⽂路径。提供了 initial_context 配置时会 在其返回的上下⽂中进⾏查找，没有提供时则直接在 InitialContext 中查找。</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li><p>mappers：在mappers标签中可以配置多个sql映射⽂件的路径。 </p>
</li>
<li><p>mapper：配置某个sql映射⽂件的路径</p>
<ul>
<li>resource属性：使⽤相对于类路径的资源引⽤⽅式 </li>
<li>url属性：使⽤完全限定资源定位符（URL）⽅式</li>
</ul>
</li>
</ul>
<h2 id="4-1-environment"><a href="#4-1-environment" class="headerlink" title="4.1 environment"></a>4.1 environment</h2><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-meta">&lt;?xml version=<span class="hljs-string">&quot;1.0&quot;</span> encoding=<span class="hljs-string">&quot;UTF-8&quot;</span> ?&gt;</span><br><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">configuration</span></span><br><span class="hljs-meta"> <span class="hljs-keyword">PUBLIC</span> <span class="hljs-string">&quot;-//mybatis.org//DTD Config 3.0//EN&quot;</span></span><br><span class="hljs-meta"> <span class="hljs-string">&quot;http://mybatis.org/dtd/mybatis-3-config.dtd&quot;</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">configuration</span>&gt;</span><br> <span class="hljs-comment">&lt;!--默认使⽤开发环境--&gt;</span><br>    <span class="hljs-comment">&lt;!--默认环境什么意思?当你使用mybatis创建SqlSessionFactory对象的时候,没有指定环境的话,默认使用哪个环境--&gt;</span><br>    <span class="hljs-comment">&lt;!--一般一个数据库会对应一个SqlSessionFactory对象--&gt;</span><br>    <span class="hljs-comment">&lt;!--一个环境environment会对应一个SqlSessionFactory对象--&gt;</span><br> <span class="hljs-comment">&lt;!--&lt;environments default=&quot;dev&quot;&gt;--&gt;</span><br> <span class="hljs-comment">&lt;!--默认使⽤⽣产环境--&gt;</span><br> <span class="hljs-tag">&lt;<span class="hljs-name">environments</span> <span class="hljs-attr">default</span>=<span class="hljs-string">&quot;production&quot;</span>&gt;</span><br>     <span class="hljs-comment">&lt;!--开发环境--&gt;</span><br>     <span class="hljs-tag">&lt;<span class="hljs-name">environment</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;dev&quot;</span>&gt;</span><br>     <span class="hljs-tag">&lt;<span class="hljs-name">transactionManager</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;JDBC&quot;</span>/&gt;</span><br>     <span class="hljs-tag">&lt;<span class="hljs-name">dataSource</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;POOLED&quot;</span>&gt;</span><br>     <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;driver&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;com.mysql.cj.jdbc.Driver&quot;</span>/&gt;</span><br>     <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;url&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;jdbc:mysql://localhost:3306/powernode&quot;</span>/&gt;</span><br>     <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;username&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;root&quot;</span>/&gt;</span><br>     <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;password&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;root&quot;</span>/&gt;</span><br>     <span class="hljs-tag">&lt;/<span class="hljs-name">dataSource</span>&gt;</span><br>     <span class="hljs-tag">&lt;/<span class="hljs-name">environment</span>&gt;</span><br>     <br>     <span class="hljs-comment">&lt;!--⽣产环境--&gt;</span><br>     <span class="hljs-tag">&lt;<span class="hljs-name">environment</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;production&quot;</span>&gt;</span><br>     <span class="hljs-tag">&lt;<span class="hljs-name">transactionManager</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;JDBC&quot;</span> /&gt;</span><br>     <span class="hljs-tag">&lt;<span class="hljs-name">dataSource</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;POOLED&quot;</span>&gt;</span><br>     <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;driver&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;com.mysql.cj.jdbc.Driver&quot;</span>/&gt;</span><br>     <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;url&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;jdbc:mysql://localhost:3306/mybatis&quot;</span>/&gt;</span><br>     <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;username&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;root&quot;</span>/&gt;</span><br>     <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;password&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;root&quot;</span>/&gt;</span><br>     <span class="hljs-tag">&lt;/<span class="hljs-name">dataSource</span>&gt;</span><br>     <span class="hljs-tag">&lt;/<span class="hljs-name">environment</span>&gt;</span><br> <span class="hljs-tag">&lt;/<span class="hljs-name">environments</span>&gt;</span><br><br> <span class="hljs-tag">&lt;<span class="hljs-name">mappers</span>&gt;</span><br>     <span class="hljs-tag">&lt;<span class="hljs-name">mapper</span> <span class="hljs-attr">resource</span>=<span class="hljs-string">&quot;CarMapper.xml&quot;</span>/&gt;</span><br> <span class="hljs-tag">&lt;/<span class="hljs-name">mappers</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">configuration</span>&gt;</span><br></code></pre></td></tr></table></figure>







<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.powernode.mybatis;<br><span class="hljs-keyword">import</span> com.powernode.mybatis.pojo.Car;<br><span class="hljs-keyword">import</span> org.apache.ibatis.io.Resources;<br><span class="hljs-keyword">import</span> org.apache.ibatis.session.SqlSession;<br><span class="hljs-keyword">import</span> org.apache.ibatis.session.SqlSessionFactory;<br><span class="hljs-keyword">import</span> org.apache.ibatis.session.SqlSessionFactoryBuilder;<br><span class="hljs-keyword">import</span> org.junit.Test;<br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ConfigurationTest</span> &#123;<br> <span class="hljs-meta">@Test</span><br> <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">testEnvironment</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> Exception&#123;<br>         <span class="hljs-comment">// 准备数据</span><br>         <span class="hljs-type">Car</span> <span class="hljs-variable">car</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Car</span>();<br>         car.setCarNum(<span class="hljs-string">&quot;133&quot;</span>);<br>         car.setBrand(<span class="hljs-string">&quot;丰⽥霸道&quot;</span>);<br>         car.setGuidePrice(<span class="hljs-number">50.3</span>);<br>         car.setProduceTime(<span class="hljs-string">&quot;2020-01-10&quot;</span>);<br>         car.setCarType(<span class="hljs-string">&quot;燃油⻋&quot;</span>);<br>         <span class="hljs-comment">// ⼀个数据库对应⼀个SqlSessionFactory对象</span><br>         <span class="hljs-comment">// 两个数据库对应两个SqlSessionFactory对象，以此类推</span><br>         <span class="hljs-type">SqlSessionFactoryBuilder</span> <span class="hljs-variable">sqlSessionFactoryBuilder</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">SqlSessionFactoryBuilder</span>();<br>         <span class="hljs-comment">// 使⽤默认数据库</span><br>         <span class="hljs-type">SqlSessionFactory</span> <span class="hljs-variable">sqlSessionFactory</span> <span class="hljs-operator">=</span> sqlSessionFactoryBuilder.build(Resources.getResourceAsStream(<span class="hljs-string">&quot;mybatis-config.xml&quot;</span>));<br>         <span class="hljs-type">SqlSession</span> <span class="hljs-variable">sqlSession</span> <span class="hljs-operator">=</span> sqlSessionFactory.openSession(<span class="hljs-literal">true</span>);<br>         <span class="hljs-type">int</span> <span class="hljs-variable">count</span> <span class="hljs-operator">=</span> sqlSession.insert(<span class="hljs-string">&quot;insertCar&quot;</span>, car);<br>         System.out.println(<span class="hljs-string">&quot;插⼊了⼏条记录：&quot;</span> + count);<br>         <span class="hljs-comment">// 使⽤指定数据库</span><br>         <span class="hljs-type">SqlSessionFactory</span> <span class="hljs-variable">sqlSessionFactory1</span> <span class="hljs-operator">=</span> sqlSessionFactoryBuilder.build(Resources.getResourceAsStream(<span class="hljs-string">&quot;mybatis-config.xml&quot;</span>),<span class="hljs-string">&quot;dev&quot;</span>);<br>         <span class="hljs-type">SqlSession</span> <span class="hljs-variable">sqlSession1</span> <span class="hljs-operator">=</span> sqlSessionFactory1.openSession(<span class="hljs-literal">true</span>);<br>         <span class="hljs-type">int</span> <span class="hljs-variable">count1</span> <span class="hljs-operator">=</span> sqlSession1.insert(<span class="hljs-string">&quot;insertCar&quot;</span>, car);<br>         System.out.println(<span class="hljs-string">&quot;插⼊了⼏条记录：&quot;</span> + count1);<br>     &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<hr>
<p><img src="https://cdn.jsdelivr.net/gh/fgcy-333/gitnote-images/2023/5/16202305182143351.png" srcset="/img/loading.gif" lazyload alt="image-20230518214341403"></p>
<hr>
<p><img src="https://cdn.jsdelivr.net/gh/fgcy-333/gitnote-images/2023/5/16202305182144126.png" srcset="/img/loading.gif" lazyload alt="image-20230518214404892"></p>
<hr>
<h2 id="4-2-transactionManager"><a href="#4-2-transactionManager" class="headerlink" title="4.2 transactionManager"></a>4.2 transactionManager</h2><p>当事务管理器是：JDBC 采⽤JDBC的原⽣事务机制：</p>
<ul>
<li>开启事务：conn.setAutoCommit(false); </li>
<li>处理业务…… </li>
<li>提交事务：conn.commit();</li>
</ul>
<p>当事务管理器是：MANAGED 交给容器去管理事务，但⽬前使⽤的是本地程序，没有容器的⽀持</p>
<ul>
<li>当mybatis找不到容器的⽀持 时：没有事务</li>
<li>也就是说只要执⾏⼀条DML语句，则提交⼀次。</li>
</ul>
<h2 id="4-3-dataSource"><a href="#4-3-dataSource" class="headerlink" title="4.3 dataSource"></a>4.3 dataSource</h2><p>使用 <code>UNPOOLED</code></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-meta">&lt;?xml version=<span class="hljs-string">&quot;1.0&quot;</span> encoding=<span class="hljs-string">&quot;UTF-8&quot;</span> ?&gt;</span><br><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">configuration</span></span><br><span class="hljs-meta"> <span class="hljs-keyword">PUBLIC</span> <span class="hljs-string">&quot;-//mybatis.org//DTD Config 3.0//EN&quot;</span></span><br><span class="hljs-meta"> <span class="hljs-string">&quot;http://mybatis.org/dtd/mybatis-3-config.dtd&quot;</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">configuration</span>&gt;</span><br> <span class="hljs-tag">&lt;<span class="hljs-name">environments</span> <span class="hljs-attr">default</span>=<span class="hljs-string">&quot;dev&quot;</span>&gt;</span><br>     <span class="hljs-tag">&lt;<span class="hljs-name">environment</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;dev&quot;</span>&gt;</span><br>     <span class="hljs-tag">&lt;<span class="hljs-name">transactionManager</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;JDBC&quot;</span>/&gt;</span><br>             <span class="hljs-tag">&lt;<span class="hljs-name">dataSource</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;UNPOOLED&quot;</span>&gt;</span><br>                     <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;driver&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;com.mysql.cj.jdbc.Driver&quot;</span>/&gt;</span><br>                     <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;url&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;jdbc:mysql://localhost:3306/powernode&quot;</span>/&gt;</span><br>                     <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;username&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;root&quot;</span>/&gt;</span><br>                     <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;password&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;root&quot;</span>/&gt;</span><br>             <span class="hljs-tag">&lt;/<span class="hljs-name">dataSource</span>&gt;</span><br>     <span class="hljs-tag">&lt;/<span class="hljs-name">environment</span>&gt;</span><br> <span class="hljs-tag">&lt;/<span class="hljs-name">environments</span>&gt;</span><br>     <span class="hljs-tag">&lt;<span class="hljs-name">mappers</span>&gt;</span><br>         <span class="hljs-tag">&lt;<span class="hljs-name">mapper</span> <span class="hljs-attr">resource</span>=<span class="hljs-string">&quot;CarMapper.xml&quot;</span>/&gt;</span><br>     <span class="hljs-tag">&lt;/<span class="hljs-name">mappers</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">configuration</span>&gt;</span><br></code></pre></td></tr></table></figure>



<p>测试代码：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Test</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">testDataSource</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> Exception&#123;<br>     <span class="hljs-comment">// 准备数据</span><br>     <span class="hljs-type">Car</span> <span class="hljs-variable">car</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Car</span>();<br>     car.setCarNum(<span class="hljs-string">&quot;133&quot;</span>);<br>     car.setBrand(<span class="hljs-string">&quot;丰⽥霸道&quot;</span>);<br>     car.setGuidePrice(<span class="hljs-number">50.3</span>);<br>     car.setProduceTime(<span class="hljs-string">&quot;2020-01-10&quot;</span>);<br>     car.setCarType(<span class="hljs-string">&quot;燃油⻋&quot;</span>);<br>     <span class="hljs-comment">// 获取SqlSessionFactory对象</span><br>     <span class="hljs-type">SqlSessionFactoryBuilder</span> <span class="hljs-variable">sqlSessionFactoryBuilder</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">SqlSessionFactoryBuilder</span>();<br>     <span class="hljs-type">SqlSessionFactory</span> <span class="hljs-variable">sqlSessionFactory</span> <span class="hljs-operator">=</span> sqlSessionFactoryBuilder.build(Resources.getResourceAsStream(<span class="hljs-string">&quot;mybatis-config3.xml&quot;</span>));<br>     <span class="hljs-comment">// 获取SqlSession对象</span><br>     <span class="hljs-type">SqlSession</span> <span class="hljs-variable">sqlSession</span> <span class="hljs-operator">=</span> sqlSessionFactory.openSession(<span class="hljs-literal">true</span>);<br>     <span class="hljs-comment">// 执⾏SQL</span><br>     <span class="hljs-type">int</span> <span class="hljs-variable">count</span> <span class="hljs-operator">=</span> sqlSession.insert(<span class="hljs-string">&quot;insertCar&quot;</span>, car);<br>     System.out.println(<span class="hljs-string">&quot;插⼊了⼏条记录：&quot;</span> + count);<br>     <span class="hljs-comment">// 关闭会话</span><br>     sqlSession.close();<br>&#125;<br></code></pre></td></tr></table></figure>

<p>当type是UNPOOLED，控制台输出：</p>
<hr>
<p><img src="https://cdn.jsdelivr.net/gh/fgcy-333/gitnote-images/2023/5/16202305190027119.png" srcset="/img/loading.gif" lazyload alt="image-20230519002735556"></p>
<hr>
<p>修改配置⽂件mybatis-config3.xml中的配置：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">dataSource</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;POOLED&quot;</span>&gt;</span><br></code></pre></td></tr></table></figure>

<p>Java测试程序不需要修改，直接执⾏，看控制台输出：</p>
<hr>
<p><img src="https://cdn.jsdelivr.net/gh/fgcy-333/gitnote-images/2023/5/16202305190028899.png" srcset="/img/loading.gif" lazyload alt="image-20230519002808456"></p>
<hr>
<p>通过测试得出：UNPOOLED不会使⽤连接池，每⼀次都会新建JDBC连接对象。POOLED会使⽤数据库 连接池。【这个连接池是mybatis⾃⼰实现的】</p>
<p>JNDI的⽅式：表示对接JNDI服务器中的连接池。这种⽅式给了我们可以使⽤第三⽅连接池的接⼝。如果 想使⽤dbcp、c3p0、druid（德鲁伊）等，需要使⽤这种⽅式。 这种再重点说⼀下type&#x3D;”POOLED”的时候，它的属性有哪些？</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-meta">&lt;?xml version=<span class="hljs-string">&quot;1.0&quot;</span> encoding=<span class="hljs-string">&quot;UTF-8&quot;</span> ?&gt;</span><br><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">configuration</span></span><br><span class="hljs-meta"> <span class="hljs-keyword">PUBLIC</span> <span class="hljs-string">&quot;-//mybatis.org//DTD Config 3.0//EN&quot;</span></span><br><span class="hljs-meta"> <span class="hljs-string">&quot;http://mybatis.org/dtd/mybatis-3-config.dtd&quot;</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">configuration</span>&gt;</span><br> <span class="hljs-tag">&lt;<span class="hljs-name">environments</span> <span class="hljs-attr">default</span>=<span class="hljs-string">&quot;dev&quot;</span>&gt;</span><br>         <span class="hljs-tag">&lt;<span class="hljs-name">environment</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;dev&quot;</span>&gt;</span><br>         <span class="hljs-tag">&lt;<span class="hljs-name">transactionManager</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;JDBC&quot;</span>/&gt;</span><br>                 <span class="hljs-tag">&lt;<span class="hljs-name">dataSource</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;POOLED&quot;</span>&gt;</span><br>                         <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;driver&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;com.mysql.cj.jdbc.Driver&quot;</span>/&gt;</span><br>                         <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;url&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;jdbc:mysql://localhost:3306/powernode&quot;</span>/&gt;</span><br>                         <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;username&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;root&quot;</span>/&gt;</span><br>                         <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;password&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;root&quot;</span>/&gt;</span><br>                         <span class="hljs-comment">&lt;!--最⼤连接数--&gt;</span><br>                         <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;poolMaximumActiveConnections&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;3&quot;</span>/&gt;</span><br>                         <span class="hljs-comment">&lt;!--最多空闲数量--&gt;</span><br>                         <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;poolMaximumIdleConnections&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;1&quot;</span>/&gt;</span><br>                         <span class="hljs-comment">&lt;!--强⾏回归池的时间--&gt;</span><br>                         <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;poolMaximumCheckoutTime&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;20000&quot;</span>/&gt;</span><br>                         <span class="hljs-comment">&lt;!--这是⼀个底层设置，如果获取连接花费了相当⻓的时间，连接池会打印状态⽇志并重新尝试获取⼀个连接（避免在误配置的情况下⼀直失败								且不打印⽇志），默认值：20000</span><br><span class="hljs-comment">                        毫秒（即 20 秒）--&gt;</span><br>                         <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;poolTimeToWait&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;20000&quot;</span>/&gt;</span><br>                 <span class="hljs-tag">&lt;/<span class="hljs-name">dataSource</span>&gt;</span><br>         <span class="hljs-tag">&lt;/<span class="hljs-name">environment</span>&gt;</span><br> <span class="hljs-tag">&lt;/<span class="hljs-name">environments</span>&gt;</span><br>    <br>     <span class="hljs-tag">&lt;<span class="hljs-name">mappers</span>&gt;</span><br>         <span class="hljs-tag">&lt;<span class="hljs-name">mapper</span> <span class="hljs-attr">resource</span>=<span class="hljs-string">&quot;CarMapper.xml&quot;</span>/&gt;</span><br>     <span class="hljs-tag">&lt;/<span class="hljs-name">mappers</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">configuration</span>&gt;</span><br></code></pre></td></tr></table></figure>

<ul>
<li><p>poolMaximumActiveConnections：最⼤的活动的连接数量。默认值10 </p>
</li>
<li><p>poolMaximumIdleConnections：最⼤的空闲连接数量。默认值5 </p>
</li>
<li><p>poolMaximumCheckoutTime：强⾏回归池的时间。默认值20秒</p>
</li>
<li><p>poolTimeToWait：当⽆法获取到空闲连接时，每隔20秒打印⼀次⽇志，避免因代码配置有误，导致傻 等。（时⻓是可以配置的）</p>
</li>
</ul>
<p> 当然，还有其他属性。对于连接池来说，以上⼏个属性⽐较重要。</p>
<p>提醒：正常使用连接池的话，池中有很多参数是需要设置的。设置好参数，可以让连接池发挥的更好。事半功倍的效果</p>
<p>具体连接池当中的参数如何配置呢？需要反复的根据当前业务情况进行测试</p>
<p>最⼤的活动的连接数量就是连接池连接数量的上限。默认值10，如果有10个请求正在使⽤这10个连接， 第11个请求只能等待空闲连接。</p>
<p>最⼤的空闲连接数量。默认值5，如何已经有了5个空闲连接，当第6个连接要空闲下来的时候，连接池会 选择关闭该连接对象。来减少数据库的开销。 需要根据系统的并发情况，来合理调整连接池最⼤连接数以及最多空闲数量。充分发挥数据库连接池的 性能。【可以根据实际情况进⾏测试，然后调整⼀个合理的数量】</p>
<hr>
<p><img src="https://cdn.jsdelivr.net/gh/fgcy-333/gitnote-images/2023/5/16202305190034783.png" srcset="/img/loading.gif" lazyload alt="image-20230519003436656"></p>
<hr>
<p>下图是默认配置：</p>
<hr>
<p><img src="https://cdn.jsdelivr.net/gh/fgcy-333/gitnote-images/2023/5/16202305190035558.png" srcset="/img/loading.gif" lazyload alt="image-20230519003539130"></p>
<hr>
<p>在以上配置的基础之上，可以编写java程序测试：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Test</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">testPool</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> Exception&#123;<br>     <span class="hljs-type">SqlSessionFactoryBuilder</span> <span class="hljs-variable">sqlSessionFactoryBuilder</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">SqlSessionFactoryBuilder</span>();<br>     <span class="hljs-type">SqlSessionFactory</span> <span class="hljs-variable">sqlSessionFactory</span> <span class="hljs-operator">=</span> sqlSessionFactoryBuilder.build(Resources.getResourceAsStream(<span class="hljs-string">&quot;mybatis-config3.xml&quot;</span>));<br>         <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">4</span>; i++) &#123;<br>             <span class="hljs-type">SqlSession</span> <span class="hljs-variable">sqlSession</span> <span class="hljs-operator">=</span> sqlSessionFactory.openSession();<br>             <span class="hljs-type">Object</span> <span class="hljs-variable">selectCarByCarNum</span> <span class="hljs-operator">=</span> sqlSession.selectOne(<span class="hljs-string">&quot;selectCarByCarNum&quot;</span>);<br>         &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<hr>
<p><img src="https://cdn.jsdelivr.net/gh/fgcy-333/gitnote-images/2023/5/16202305190036738.png" srcset="/img/loading.gif" lazyload alt="image-20230519003651171"></p>
<hr>
<h2 id="4-4-properties"><a href="#4-4-properties" class="headerlink" title="4.4 properties"></a>4.4 properties</h2><p>mybatis提供了更加灵活的配置，连接数据库的信息可以单独写到⼀个属性资源⽂件中</p>
<p>假设在类的根路 径下创建jdbc.properties⽂件，配置如下：</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs properties"><span class="hljs-attr">jdbc.driver</span>=<span class="hljs-string">com.mysql.cj.jdbc.Driver</span><br><span class="hljs-attr">jdbc.url</span>=<span class="hljs-string">jdbc:mysql://localhost:3306/powernode</span><br></code></pre></td></tr></table></figure>





<p>在mybatis核⼼配置⽂件中引⼊并使⽤：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-meta">&lt;?xml version=<span class="hljs-string">&quot;1.0&quot;</span> encoding=<span class="hljs-string">&quot;UTF-8&quot;</span> ?&gt;</span><br><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">configuration</span></span><br><span class="hljs-meta"> <span class="hljs-keyword">PUBLIC</span> <span class="hljs-string">&quot;-//mybatis.org//DTD Config 3.0//EN&quot;</span></span><br><span class="hljs-meta"> <span class="hljs-string">&quot;http://mybatis.org/dtd/mybatis-3-config.dtd&quot;</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">configuration</span>&gt;</span><br>         <span class="hljs-comment">&lt;!--引⼊外部属性资源⽂件--&gt;</span><br>         <span class="hljs-tag">&lt;<span class="hljs-name">properties</span> <span class="hljs-attr">resource</span>=<span class="hljs-string">&quot;jdbc.properties&quot;</span>&gt;</span><br>             <span class="hljs-comment">&lt;!--也可以内部定义--&gt;</span><br>                 <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;jdbc.username&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;root&quot;</span>/&gt;</span><br>                 <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;jdbc.password&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;root&quot;</span>/&gt;</span><br>         <span class="hljs-tag">&lt;/<span class="hljs-name">properties</span>&gt;</span><br>    <br>     <span class="hljs-tag">&lt;<span class="hljs-name">environments</span> <span class="hljs-attr">default</span>=<span class="hljs-string">&quot;dev&quot;</span>&gt;</span><br>             <span class="hljs-tag">&lt;<span class="hljs-name">environment</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;dev&quot;</span>&gt;</span><br>             <span class="hljs-tag">&lt;<span class="hljs-name">transactionManager</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;JDBC&quot;</span>/&gt;</span><br>                     <span class="hljs-tag">&lt;<span class="hljs-name">dataSource</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;POOLED&quot;</span>&gt;</span><br>                             <span class="hljs-comment">&lt;!--$&#123;key&#125;使⽤--&gt;</span><br>                             <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;driver&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;$&#123;jdbc.driver&#125;&quot;</span>/&gt;</span><br>                             <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;url&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;$&#123;jdbc.url&#125;&quot;</span>/&gt;</span><br>                             <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;username&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;$&#123;jdbc.username&#125;&quot;</span>/&gt;</span><br>                             <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;password&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;$&#123;jdbc.password&#125;&quot;</span>/&gt;</span><br>                     <span class="hljs-tag">&lt;/<span class="hljs-name">dataSource</span>&gt;</span><br>             <span class="hljs-tag">&lt;/<span class="hljs-name">environment</span>&gt;</span><br>     <span class="hljs-tag">&lt;/<span class="hljs-name">environments</span>&gt;</span><br>    <br>     <span class="hljs-tag">&lt;<span class="hljs-name">mappers</span>&gt;</span><br>         <span class="hljs-tag">&lt;<span class="hljs-name">mapper</span> <span class="hljs-attr">resource</span>=<span class="hljs-string">&quot;CarMapper.xml&quot;</span>/&gt;</span><br>     <span class="hljs-tag">&lt;/<span class="hljs-name">mappers</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">configuration</span>&gt;</span><br></code></pre></td></tr></table></figure>

<p>properties两个属性：</p>
<ul>
<li>resource：这个属性从类的根路径下开始加载。【常⽤的】 </li>
<li>url：从指定的url加载，假设⽂件放在d:&#x2F;jdbc.properties，这个url可以写成： <code>file:///d:/jdbc.properties</code>。注意是三个斜杠。</li>
</ul>
<p>注意：如果不知道mybatis-config.xml⽂件中标签的编写顺序的话，可以有两种⽅式知道它的顺序： </p>
<p>第⼀种⽅式：查看dtd约束⽂件</p>
<p>第⼆种⽅式：通过idea的报错提示信息。【⼀般采⽤这种⽅式】</p>
<h2 id="4-5-mapper"><a href="#4-5-mapper" class="headerlink" title="4.5 mapper"></a>4.5 mapper</h2><p>mapper标签⽤来指定SQL映射⽂件的路径，包含多种指定⽅式，这⾥先主要看其中两种： 第⼀种：resource，从类的根路径下开始加载【⽐url常⽤】</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">mappers</span>&gt;</span><br>     <span class="hljs-tag">&lt;<span class="hljs-name">mapper</span> <span class="hljs-attr">resource</span>=<span class="hljs-string">&quot;CarMapper.xml&quot;</span>/&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">mappers</span>&gt;</span><br></code></pre></td></tr></table></figure>



<p>如果是这样写的话，必须保证类的根下有CarMapper.xml⽂件。 如果类的根路径下有⼀个包叫做test，CarMapper.xml如果放在test包下的话，这个配置应该是这样写：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">mappers</span>&gt;</span><br>     <span class="hljs-tag">&lt;<span class="hljs-name">mapper</span> <span class="hljs-attr">resource</span>=<span class="hljs-string">&quot;test/CarMapper.xml&quot;</span>/&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">mappers</span>&gt;</span><br></code></pre></td></tr></table></figure>



<p>第⼆种：url，从指定的url位置加载 假设CarMapper.xml⽂件放在d盘的根下，这个配置就需要这样写：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">mappers</span>&gt;</span><br> <span class="hljs-tag">&lt;<span class="hljs-name">mapper</span> <span class="hljs-attr">url</span>=<span class="hljs-string">&quot;file:///d:/CarMapper.xml&quot;</span>/&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">mappers</span>&gt;</span><br></code></pre></td></tr></table></figure>

<blockquote>
<p>mapper还有其他的指定⽅式，后⾯再看！！！</p>
</blockquote>
<h1 id="五、⼿写MyBatis框架（掌握原理）"><a href="#五、⼿写MyBatis框架（掌握原理）" class="headerlink" title="五、⼿写MyBatis框架（掌握原理）"></a>五、⼿写MyBatis框架（掌握原理）</h1><h2 id="5-1-dom4j解析XML⽂件"><a href="#5-1-dom4j解析XML⽂件" class="headerlink" title="5.1 dom4j解析XML⽂件"></a>5.1 dom4j解析XML⽂件</h2><p>第⼀步：引⼊dom4j的依赖</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-meta">&lt;?xml version=<span class="hljs-string">&quot;1.0&quot;</span> encoding=<span class="hljs-string">&quot;UTF-8&quot;</span>?&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">project</span> <span class="hljs-attr">xmlns</span>=<span class="hljs-string">&quot;http://maven.apache.org/POM/4.0.0&quot;</span></span><br><span class="hljs-tag"> <span class="hljs-attr">xmlns:xsi</span>=<span class="hljs-string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span><br><span class="hljs-tag"> <span class="hljs-attr">xsi:schemaLocation</span>=<span class="hljs-string">&quot;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd&quot;</span>&gt;</span><br> <span class="hljs-tag">&lt;<span class="hljs-name">modelVersion</span>&gt;</span>4.0.0<span class="hljs-tag">&lt;/<span class="hljs-name">modelVersion</span>&gt;</span><br> <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.group<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br> <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>parse-xml-by-dom4j<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br> <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>1.0-SNAPSHOT<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br> <span class="hljs-tag">&lt;<span class="hljs-name">packaging</span>&gt;</span>jar<span class="hljs-tag">&lt;/<span class="hljs-name">packaging</span>&gt;</span><br>    <br>     <span class="hljs-tag">&lt;<span class="hljs-name">dependencies</span>&gt;</span><br><br>             <span class="hljs-comment">&lt;!--dom4j依赖--&gt;</span><br>             <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>                 <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.dom4j<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>                 <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>dom4j<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>                 <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>2.1.3<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br>             <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br><br>             <span class="hljs-comment">&lt;!--jaxen依赖--&gt;</span><br>             <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>                 <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>jaxen<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>                 <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>jaxen<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>                 <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>1.2.0<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br>             <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br><br>             <span class="hljs-comment">&lt;!--junit依赖--&gt;</span><br>             <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>                 <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>junit<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>                 <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>junit<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>                 <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>4.13.2<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br>                 <span class="hljs-tag">&lt;<span class="hljs-name">scope</span>&gt;</span>test<span class="hljs-tag">&lt;/<span class="hljs-name">scope</span>&gt;</span><br>             <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br>     <span class="hljs-tag">&lt;/<span class="hljs-name">dependencies</span>&gt;</span><br>    <br>    <br>     <span class="hljs-tag">&lt;<span class="hljs-name">properties</span>&gt;</span><br>             <span class="hljs-tag">&lt;<span class="hljs-name">maven.compiler.source</span>&gt;</span>17<span class="hljs-tag">&lt;/<span class="hljs-name">maven.compiler.source</span>&gt;</span><br>             <span class="hljs-tag">&lt;<span class="hljs-name">maven.compiler.target</span>&gt;</span>17<span class="hljs-tag">&lt;/<span class="hljs-name">maven.compiler.target</span>&gt;</span><br>     <span class="hljs-tag">&lt;/<span class="hljs-name">properties</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">project</span>&gt;</span><br></code></pre></td></tr></table></figure>



<p>第⼆步：编写配置⽂件godbatis-config.xml</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-meta">&lt;?xml version=<span class="hljs-string">&quot;1.0&quot;</span> encoding=<span class="hljs-string">&quot;UTF-8&quot;</span> ?&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">configuration</span>&gt;</span><br> <span class="hljs-tag">&lt;<span class="hljs-name">environments</span> <span class="hljs-attr">default</span>=<span class="hljs-string">&quot;dev&quot;</span>&gt;</span><br>     <span class="hljs-tag">&lt;<span class="hljs-name">environment</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;dev&quot;</span>&gt;</span><br>         <span class="hljs-tag">&lt;<span class="hljs-name">transactionManager</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;JDBC&quot;</span>/&gt;</span><br>         <span class="hljs-tag">&lt;<span class="hljs-name">dataSource</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;POOLED&quot;</span>&gt;</span><br>                 <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;driver&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;com.mysql.cj.jdbc.Driver&quot;</span>/&gt;</span><br>                 <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;url&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;jdbc:mysql://localhost:3306/powernode&quot;</span>/&gt;</span><br>                 <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;username&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;root&quot;</span>/&gt;</span><br>                 <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;password&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;root&quot;</span>/&gt;</span><br>         <span class="hljs-tag">&lt;/<span class="hljs-name">dataSource</span>&gt;</span><br>     <span class="hljs-tag">&lt;/<span class="hljs-name">environment</span>&gt;</span><br>     <span class="hljs-tag">&lt;<span class="hljs-name">mappers</span>&gt;</span><br>         <span class="hljs-tag">&lt;<span class="hljs-name">mapper</span> <span class="hljs-attr">resource</span>=<span class="hljs-string">&quot;sqlmapper.xml&quot;</span>/&gt;</span><br>     <span class="hljs-tag">&lt;/<span class="hljs-name">mappers</span>&gt;</span><br> <span class="hljs-tag">&lt;/<span class="hljs-name">environments</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">configuration</span>&gt;</span><br></code></pre></td></tr></table></figure>



<p>第三步：解析godbatis-config.xml</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.powernode.dom4j;<br><span class="hljs-keyword">import</span> org.dom4j.Document;<br><span class="hljs-keyword">import</span> org.dom4j.Element;<br><span class="hljs-keyword">import</span> org.dom4j.Node;<br><span class="hljs-keyword">import</span> org.dom4j.io.SAXReader;<br><span class="hljs-keyword">import</span> org.junit.Test;<br><span class="hljs-keyword">import</span> java.util.HashMap;<br><span class="hljs-keyword">import</span> java.util.List;<br><span class="hljs-keyword">import</span> java.util.Map;<br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * 使⽤dom4j解析XML⽂件</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ParseXMLByDom4j</span> &#123;<br>     <span class="hljs-meta">@Test</span><br>     <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">testGodBatisConfig</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> Exception&#123;<br>             <span class="hljs-comment">// 读取xml，获取document对象</span><br>             <span class="hljs-type">SAXReader</span> <span class="hljs-variable">saxReader</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">SAXReader</span>();<br>             <span class="hljs-type">Document</span> <span class="hljs-variable">document</span> <span class="hljs-operator">=</span> saxReader.read(Thread.currentThread().getContextClassLoader().getResourceAsStream(<span class="hljs-string">&quot;godbatis-config.xml&quot;</span>));<br>             <span class="hljs-comment">// 获取&lt;environments&gt;标签的default属性的值</span><br>         	<span class="hljs-comment">//xpath是做标签路径匹配的。能够让我们快速定位XML文件中的元素</span><br>         	<span class="hljs-comment">// 以下的xpath代表了：从根下开始找configuration标签，然后找configuration标签下的子标签environments</span><br>        	<span class="hljs-comment">// Element是Node类的子类，方法更多，使用更便捷。</span><br>             <span class="hljs-type">Element</span> <span class="hljs-variable">environmentsElt</span> <span class="hljs-operator">=</span> (Element)document.selectSingleNode(<span class="hljs-string">&quot;/configuration/environments&quot;</span>);<br>             <span class="hljs-type">String</span> <span class="hljs-variable">defaultId</span> <span class="hljs-operator">=</span> environmentsElt.attributeValue(<span class="hljs-string">&quot;default&quot;</span>);<br>             System.out.println(defaultId);<br>             <span class="hljs-comment">// 获取environment标签</span><br>             <span class="hljs-type">Element</span> <span class="hljs-variable">environmentElt</span> <span class="hljs-operator">=</span> (Element)document.selectSingleNode(<span class="hljs-string">&quot;/configuration/environments/environment[@id=&#x27;&quot;</span> + defaultId + <span class="hljs-string">&quot;&#x27;]&quot;</span>);<br>             <span class="hljs-comment">// 获取事务管理器类型</span><br>             <span class="hljs-type">Element</span> <span class="hljs-variable">transactionManager</span> <span class="hljs-operator">=</span> environmentElt.element(<span class="hljs-string">&quot;transactionManager&quot;</span>);<br>             <span class="hljs-type">String</span> <span class="hljs-variable">transactionManagerType</span> <span class="hljs-operator">=</span> transactionManager.attributeValue(<span class="hljs-string">&quot;type&quot;</span>);<br>             System.out.println(transactionManagerType);<br>             <span class="hljs-comment">// 获取数据源类型</span><br>             <span class="hljs-type">Element</span> <span class="hljs-variable">dataSource</span> <span class="hljs-operator">=</span> environmentElt.element(<span class="hljs-string">&quot;dataSource&quot;</span>);<br>             <span class="hljs-type">String</span> <span class="hljs-variable">dataSourceType</span> <span class="hljs-operator">=</span> dataSource.attributeValue(<span class="hljs-string">&quot;type&quot;</span>);<br>             System.out.println(dataSourceType);<br>             <span class="hljs-comment">// 将数据源信息封装到Map集合</span><br>             Map&lt;String,String&gt; dataSourceMap = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>&lt;&gt;();<br>             dataSource.elements().forEach(propertyElt -&gt; &#123;<br>             dataSourceMap.put(propertyElt.attributeValue(<span class="hljs-string">&quot;name&quot;</span>), propertyElt.attributeValue(<span class="hljs-string">&quot;value&quot;</span>));<br>             &#125;);<br>             dataSourceMap.forEach((k, v) -&gt; System.out.println(k + <span class="hljs-string">&quot;:&quot;</span> + v));<br>             <span class="hljs-comment">// 获取sqlmapper.xml⽂件的路径</span><br>             <span class="hljs-type">Element</span> <span class="hljs-variable">mappersElt</span> <span class="hljs-operator">=</span> (Element) document.selectSingleNode(<span class="hljs-string">&quot;/configuration/environments/mappers&quot;</span>);<br>             mappersElt.elements().forEach(mapper -&gt; &#123;<br>             System.out.println(mapper.attributeValue(<span class="hljs-string">&quot;resource&quot;</span>));<br>             &#125;);<br>     &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>执⾏结果：</p>
<hr>
<p><img src="https://cdn.jsdelivr.net/gh/fgcy-333/gitnote-images/2023/5/16202305190058274.png" srcset="/img/loading.gif" lazyload alt="image-20230519005835934"></p>
<hr>
<p>第四步：编写配置⽂件sqlmapper.xml</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-meta">&lt;?xml version=<span class="hljs-string">&quot;1.0&quot;</span> encoding=<span class="hljs-string">&quot;UTF-8&quot;</span> ?&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">mapper</span> <span class="hljs-attr">namespace</span>=<span class="hljs-string">&quot;car&quot;</span>&gt;</span><br> <span class="hljs-tag">&lt;<span class="hljs-name">insert</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;insertCar&quot;</span>&gt;</span><br> insert into t_car(id,car_num,brand,guide_price,produce_time,car_ty<br>pe) values(null,#&#123;carNum&#125;,#&#123;brand&#125;,#&#123;guidePrice&#125;,#&#123;produceTime&#125;,#&#123;carType&#125;)<br> <span class="hljs-tag">&lt;/<span class="hljs-name">insert</span>&gt;</span><br> <span class="hljs-tag">&lt;<span class="hljs-name">select</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;selectCarByCarNum&quot;</span> <span class="hljs-attr">resultType</span>=<span class="hljs-string">&quot;com.powernode.mybatis.pojo.Car&quot;</span>&gt;</span><br> select id,car_num carNum,brand,guide_price guidePrice,produce_time produceTime,car_type carType from t_car where car_num = #&#123;carNum&#125;<br> <span class="hljs-tag">&lt;/<span class="hljs-name">select</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">mapper</span>&gt;</span><br></code></pre></td></tr></table></figure>



<p>第五步：解析sqlmapper.xml</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Test</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">testSqlMapper</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> Exception&#123;<br>     <span class="hljs-comment">// 读取xml，获取document对象 代表了整个XML文件</span><br>     <span class="hljs-type">SAXReader</span> <span class="hljs-variable">saxReader</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">SAXReader</span>();<br>     <span class="hljs-type">Document</span> <span class="hljs-variable">document</span> <span class="hljs-operator">=</span> saxReader.read(Thread.currentThread().getContextClassLoader().getResourceAsStream(<span class="hljs-string">&quot;sqlmapper.xml&quot;</span>));<br>     <br>    <span class="hljs-comment">// 获取namespace</span><br>     <span class="hljs-type">Element</span> <span class="hljs-variable">mapperElt</span> <span class="hljs-operator">=</span> (Element) document.selectSingleNode(<span class="hljs-string">&quot;/mapper&quot;</span>);<br>     <span class="hljs-type">String</span> <span class="hljs-variable">namespace</span> <span class="hljs-operator">=</span> mapperElt.attributeValue(<span class="hljs-string">&quot;namespace&quot;</span>);<br>     System.out.println(namespace);<br>     <span class="hljs-comment">// 获取sql id</span><br>     mapperElt.elements().forEach(statementElt -&gt; &#123;<br>     <span class="hljs-comment">// 标签名</span><br>     <span class="hljs-type">String</span> <span class="hljs-variable">name</span> <span class="hljs-operator">=</span> statementElt.getName();<br>     System.out.println(<span class="hljs-string">&quot;name:&quot;</span> + name);<br>     <span class="hljs-comment">// 如果是select标签，还要获取它的resultType</span><br>     <span class="hljs-keyword">if</span> (<span class="hljs-string">&quot;select&quot;</span>.equals(name)) &#123;<br>         <span class="hljs-type">String</span> <span class="hljs-variable">resultType</span> <span class="hljs-operator">=</span> statementElt.attributeValue(<span class="hljs-string">&quot;resultType&quot;</span>);<span class="hljs-comment">// 没有这个属性的话，会自动返回&quot;null&quot;</span><br>         System.out.println(<span class="hljs-string">&quot;resultType:&quot;</span> + resultType);<br>     &#125;<br>     <span class="hljs-comment">// sql id</span><br>     <span class="hljs-type">String</span> <span class="hljs-variable">id</span> <span class="hljs-operator">=</span> statementElt.attributeValue(<span class="hljs-string">&quot;id&quot;</span>);<br>     System.out.println(<span class="hljs-string">&quot;sqlId:&quot;</span> + id);<br>     <span class="hljs-comment">// sql语句</span><br>     <span class="hljs-comment">// 获取标签中的sql语句（表示获取标签中的文本内容，而且去除前后空白）</span><br>     <span class="hljs-type">String</span> <span class="hljs-variable">sql</span> <span class="hljs-operator">=</span> statementElt.getTextTrim();<br>     <span class="hljs-comment">// mybaits封装了jdbc。 早晚要执行带有?的sql语句。</span><br>     <span class="hljs-comment">//String newSql = sql.replaceAll( regex: &quot;#\\&#123;[0-9A-Za-z_$]+&#125;&quot;, replacement: &quot;?&quot;);</span><br>     System.out.println(<span class="hljs-string">&quot;sql:&quot;</span> + sql);<br>     &#125;);<br>&#125;<br></code></pre></td></tr></table></figure>

<p>执⾏结果：</p>
<hr>
<p><img src="https://cdn.jsdelivr.net/gh/fgcy-333/gitnote-images/2023/5/16202305190100291.png" srcset="/img/loading.gif" lazyload alt="image-20230519010008568"></p>
<hr>
<h2 id="5-2-GodBatis"><a href="#5-2-GodBatis" class="headerlink" title="5.2 GodBatis"></a>5.2 GodBatis</h2><p>⼿写框架之前，如果没有思路，可以先参考⼀下mybatis的客户端程序，通过客户端程序来逆推需要的 类，参考代码：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Test</span><br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">testInsert</span><span class="hljs-params">()</span> &#123;<br>       <span class="hljs-type">SqlSession</span> <span class="hljs-variable">sqlSession</span> <span class="hljs-operator">=</span> <span class="hljs-literal">null</span>;<br>       <span class="hljs-keyword">try</span> &#123;<br>           <span class="hljs-comment">// 1.创建SqlSessionFactoryBuilder对象</span><br>           <span class="hljs-type">SqlSessionFactoryBuilder</span> <span class="hljs-variable">sqlSessionFactoryBuilder</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">SqlSessionFactoryBuilder</span>();<br>           <span class="hljs-comment">// 2.创建SqlSessionFactory对象</span><br>           <span class="hljs-type">SqlSessionFactory</span> <span class="hljs-variable">sqlSessionFactory</span> <span class="hljs-operator">=</span> sqlSessionFactoryBuilder.build(Resources.getResourceAsStream(<span class="hljs-string">&quot;mybatis-config.xml&quot;</span>));<br>           <span class="hljs-comment">// 3.创建SqlSession对象</span><br>           sqlSession = sqlSessionFactory.openSession();<br>           <span class="hljs-comment">// 4.执⾏SQL</span><br>           <span class="hljs-type">Car</span> <span class="hljs-variable">car</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Car</span>(<span class="hljs-literal">null</span>, <span class="hljs-string">&quot;111&quot;</span>, <span class="hljs-string">&quot;宝⻢X7&quot;</span>, <span class="hljs-string">&quot;70.3&quot;</span>, <span class="hljs-string">&quot;2010-10-11&quot;</span>, <span class="hljs-string">&quot;燃油⻋&quot;</span>);<br>           <span class="hljs-type">int</span> <span class="hljs-variable">count</span> <span class="hljs-operator">=</span> sqlSession.insert(<span class="hljs-string">&quot;insertCar&quot;</span>, car);<br>           System.out.println(<span class="hljs-string">&quot;更新了⼏条记录：&quot;</span> + count);<br>           <span class="hljs-comment">// 5.提交</span><br>           sqlSession.commit();<br>       &#125; <span class="hljs-keyword">catch</span> (Exception e) &#123;<br>           <span class="hljs-comment">// 回滚</span><br>           <span class="hljs-keyword">if</span> (sqlSession != <span class="hljs-literal">null</span>) &#123;<br>               sqlSession.rollback();<br>           &#125;<br>           e.printStackTrace();<br>       &#125; <span class="hljs-keyword">finally</span> &#123;<br>           <span class="hljs-comment">// 6.关闭</span><br>           <span class="hljs-keyword">if</span> (sqlSession != <span class="hljs-literal">null</span>) &#123;<br>               sqlSession.close();<br>           &#125;<br>       &#125;<br>   &#125;<br><br><br>   <span class="hljs-meta">@Test</span><br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">testSelectOne</span><span class="hljs-params">()</span> &#123;<br>       <span class="hljs-type">SqlSession</span> <span class="hljs-variable">sqlSession</span> <span class="hljs-operator">=</span> <span class="hljs-literal">null</span>;<br>       <span class="hljs-keyword">try</span> &#123;<br>           <span class="hljs-comment">// 1.创建SqlSessionFactoryBuilder对象</span><br>           <span class="hljs-type">SqlSessionFactoryBuilder</span> <span class="hljs-variable">sqlSessionFactoryBuilder</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">SqlSessionFactoryBuilder</span>();<br>           <span class="hljs-comment">// 2.创建SqlSessionFactory对象</span><br>           <span class="hljs-type">SqlSessionFactory</span> <span class="hljs-variable">sqlSessionFactory</span> <span class="hljs-operator">=</span> sqlSessionFactoryBuilder.build(Resources.getResourceAsStream(<span class="hljs-string">&quot;mybatis-config.xml&quot;</span>));<br>           <span class="hljs-comment">// 3.创建SqlSession对象</span><br>           sqlSession = sqlSessionFactory.openSession();<br>           <span class="hljs-comment">// 4.执⾏SQL</span><br>           <span class="hljs-type">Car</span> <span class="hljs-variable">car</span> <span class="hljs-operator">=</span> (Car) sqlSession.selectOne(<span class="hljs-string">&quot;selectCarByCarNum&quot;</span>, <span class="hljs-string">&quot;111&quot;</span>);<br>           System.out.println(car);<br>           <span class="hljs-comment">// 5.提交</span><br>           sqlSession.commit();<br>       &#125; <span class="hljs-keyword">catch</span> (Exception e) &#123;<br>           <span class="hljs-comment">// 回滚</span><br>           <span class="hljs-keyword">if</span> (sqlSession != <span class="hljs-literal">null</span>) &#123;<br>               sqlSession.rollback();<br>           &#125;<br>           e.printStackTrace();<br>       &#125; <span class="hljs-keyword">finally</span> &#123;<br>           <span class="hljs-comment">// 6.关闭</span><br>           <span class="hljs-keyword">if</span> (sqlSession != <span class="hljs-literal">null</span>) &#123;<br>               sqlSession.close();<br>           &#125;<br>       &#125;<br></code></pre></td></tr></table></figure>

<h3 id="IDEA中创建模块"><a href="#IDEA中创建模块" class="headerlink" title="IDEA中创建模块"></a>IDEA中创建模块</h3><p>模块：godbatis（创建普通的Java Maven模块，打包⽅式jar），引⼊相关依赖</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-meta">&lt;?xml version=<span class="hljs-string">&quot;1.0&quot;</span> encoding=<span class="hljs-string">&quot;UTF-8&quot;</span>?&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">project</span> <span class="hljs-attr">xmlns</span>=<span class="hljs-string">&quot;http://maven.apache.org/POM/4.0.0&quot;</span></span><br><span class="hljs-tag">         <span class="hljs-attr">xmlns:xsi</span>=<span class="hljs-string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span><br><span class="hljs-tag">         <span class="hljs-attr">xsi:schemaLocation</span>=<span class="hljs-string">&quot;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd&quot;</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">modelVersion</span>&gt;</span>4.0.0<span class="hljs-tag">&lt;/<span class="hljs-name">modelVersion</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.god<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>godbatis<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>1.0.0<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">packaging</span>&gt;</span>jar<span class="hljs-tag">&lt;/<span class="hljs-name">packaging</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">dependencies</span>&gt;</span><br>        <br>        <span class="hljs-comment">&lt;!--dom4j依赖--&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.dom4j<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>dom4j<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>2.1.3<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br>        <br>        <span class="hljs-comment">&lt;!--jaxen依赖--&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>jaxen<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>jaxen<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>1.2.0<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br>        <br>        <span class="hljs-comment">&lt;!--junit依赖--&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>junit<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>junit<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>4.13.2<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">scope</span>&gt;</span>test<span class="hljs-tag">&lt;/<span class="hljs-name">scope</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">dependencies</span>&gt;</span><br><br>    <span class="hljs-tag">&lt;<span class="hljs-name">properties</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">maven.compiler.source</span>&gt;</span>17<span class="hljs-tag">&lt;/<span class="hljs-name">maven.compiler.source</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">maven.compiler.target</span>&gt;</span>17<span class="hljs-tag">&lt;/<span class="hljs-name">maven.compiler.target</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">properties</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">project</span>&gt;</span><br></code></pre></td></tr></table></figure>



<h3 id="资源⼯具类，⽅便获取指向配置⽂件的输⼊流"><a href="#资源⼯具类，⽅便获取指向配置⽂件的输⼊流" class="headerlink" title="资源⼯具类，⽅便获取指向配置⽂件的输⼊流"></a>资源⼯具类，⽅便获取指向配置⽂件的输⼊流</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">import</span> java.io.InputStream;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Resources</span> &#123;<br><br><br>    <span class="hljs-keyword">private</span> <span class="hljs-title function_">Resources</span><span class="hljs-params">()</span> &#123;<br><br>    &#125;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * 从类路径中获取配置⽂件的输⼊流</span><br><span class="hljs-comment">     *</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> config</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span> 输⼊流，该输⼊流指向类路径中的配置⽂件</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> InputStream <span class="hljs-title function_">getResourcesAsStream</span><span class="hljs-params">(String config)</span> &#123;<br>        <span class="hljs-keyword">return</span> Thread.currentThread().getContextClassLoader().getResourceAsStream(config);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>



<h3 id="SqlSessionFactoryBuilder类"><a href="#SqlSessionFactoryBuilder类" class="headerlink" title="SqlSessionFactoryBuilder类"></a>SqlSessionFactoryBuilder类</h3><p>提供⼀个⽆参数构造⽅法，再提供⼀个build⽅法，该build⽅法要返回SqlSessionFactory对象</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">import</span> org.dom4j.Document;<br><span class="hljs-keyword">import</span> org.dom4j.DocumentException;<br><span class="hljs-keyword">import</span> org.dom4j.Element;<br><span class="hljs-keyword">import</span> org.dom4j.io.SAXReader;<br><br><span class="hljs-keyword">import</span> javax.sql.DataSource;<br><span class="hljs-keyword">import</span> java.io.InputStream;<br><span class="hljs-keyword">import</span> java.util.HashMap;<br><span class="hljs-keyword">import</span> java.util.Map;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">SqlSessionFactoryBuilder</span> &#123;<br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * 创建构建器对象</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">SqlSessionFactoryBuilder</span><span class="hljs-params">()</span> &#123;<br>        <br>    &#125;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * 获取SqlSessionFactory对象</span><br><span class="hljs-comment">     * 该⽅法主要功能是：读取godbatis核⼼配置⽂件，并构建SqlSessionFactory对象</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">public</span> SqlSessionFactory <span class="hljs-title function_">build</span><span class="hljs-params">(InputStream inputStream)</span> <span class="hljs-keyword">throws</span> Docume ntException &#123;<br>        <span class="hljs-type">SAXReader</span> <span class="hljs-variable">saxReader</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">SAXReader</span>();<br>        <span class="hljs-type">Document</span> <span class="hljs-variable">document</span> <span class="hljs-operator">=</span> saxReader.read(inputStream);<br>        <span class="hljs-type">Element</span> <span class="hljs-variable">environmentsElt</span> <span class="hljs-operator">=</span> (Element) document.selectSingleNode(<span class="hljs-string">&quot;/configuration / environments&quot;</span>);<br>        <span class="hljs-type">String</span> <span class="hljs-variable">defaultEnv</span> <span class="hljs-operator">=</span> environmentsElt.attributeValue(<span class="hljs-string">&quot;default&quot;</span>);<br>        <span class="hljs-type">Element</span> <span class="hljs-variable">environmentElt</span> <span class="hljs-operator">=</span> (Element) document.selectSingleNode(<span class="hljs-string">&quot;/configuration / environments / environment[ @id=&#x27;&quot;</span> + defaultEnv + <span class="hljs-string">&quot;&#x27;]&quot;</span>);<br>        <span class="hljs-comment">// 解析配置⽂件，创建数据源对象</span><br>        <span class="hljs-type">Element</span> <span class="hljs-variable">dataSourceElt</span> <span class="hljs-operator">=</span> environmentElt.element(<span class="hljs-string">&quot;dataSource&quot;</span>);<br>        <span class="hljs-type">DataSource</span> <span class="hljs-variable">dataSource</span> <span class="hljs-operator">=</span> getDataSource(dataSourceElt);<br>        <span class="hljs-comment">// 解析配置⽂件，创建事务管理器对象</span><br>        <span class="hljs-type">Element</span> <span class="hljs-variable">transactionManagerElt</span> <span class="hljs-operator">=</span> environmentElt.element(<span class="hljs-string">&quot;transactionManager&quot;</span>);<br>        <span class="hljs-type">TransactionManager</span> <span class="hljs-variable">transactionManager</span> <span class="hljs-operator">=</span> getTransactionManager(transactionManagerElt, dataSource);<br>        <span class="hljs-comment">// 解析配置⽂件，获取所有的SQL映射对象</span><br>        <span class="hljs-type">Element</span> <span class="hljs-variable">mappers</span> <span class="hljs-operator">=</span> environmentsElt.element(<span class="hljs-string">&quot;mappers&quot;</span>);<br>        Map&lt;String, GodMappedStatement&gt; mappedStatements = getMappedStatements(mappers);<br>        <span class="hljs-comment">// 将以上信息封装到SqlSessionFactory对象中</span><br>        <span class="hljs-type">SqlSessionFactory</span> <span class="hljs-variable">sqlSessionFactory</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">SqlSessionFactory</span>(transactionManager, mappedStatements);<br>        <span class="hljs-comment">// 返回</span><br>        <span class="hljs-keyword">return</span> sqlSessionFactory;<br>    &#125;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * 解析xml文件 将映射配置文件中的信息封装到MappedStatement中</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">private</span> Map&lt;String, GodMappedStatement&gt; <span class="hljs-title function_">getMappedStatements</span><span class="hljs-params">(Element mappers)</span> &#123;<br>        Map&lt;String, GodMappedStatement&gt; mappedStatements = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>&lt;&gt;();<br>        mappers.elements().forEach(mapperElt -&gt; &#123;<br>            <span class="hljs-keyword">try</span> &#123;<br>                <span class="hljs-type">String</span> <span class="hljs-variable">resource</span> <span class="hljs-operator">=</span> mapperElt.attributeValue(<span class="hljs-string">&quot;resource&quot;</span>);<br>                <span class="hljs-type">SAXReader</span> <span class="hljs-variable">saxReader</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">SAXReader</span>();<br>                <span class="hljs-type">Document</span> <span class="hljs-variable">document</span> <span class="hljs-operator">=</span> saxReader.read(Resources.getResourcesAsStream(resource));<br>                <span class="hljs-type">Element</span> <span class="hljs-variable">mapper</span> <span class="hljs-operator">=</span> (Element) document.selectSingleNode(<span class="hljs-string">&quot;/mapper&quot;</span>);<br>                <span class="hljs-type">String</span> <span class="hljs-variable">namespace</span> <span class="hljs-operator">=</span> mapper.attributeValue(<span class="hljs-string">&quot;namespace&quot;</span>);<br>                mapper.elements().forEach(sqlMapper -&gt; &#123;<br>                    <span class="hljs-type">String</span> <span class="hljs-variable">sqlId</span> <span class="hljs-operator">=</span> sqlMapper.attributeValue(<span class="hljs-string">&quot;id&quot;</span>);<br>                    <span class="hljs-type">String</span> <span class="hljs-variable">sql</span> <span class="hljs-operator">=</span> sqlMapper.getTextTrim();<br>                    <span class="hljs-type">String</span> <span class="hljs-variable">parameterType</span> <span class="hljs-operator">=</span> sqlMapper.attributeValue(<span class="hljs-string">&quot;parameterType&quot;</span>);<br>                    <span class="hljs-type">String</span> <span class="hljs-variable">resultType</span> <span class="hljs-operator">=</span> sqlMapper.attributeValue(<span class="hljs-string">&quot;resultType&quot;</span>);<br>                    <span class="hljs-type">String</span> <span class="hljs-variable">sqlType</span> <span class="hljs-operator">=</span> sqlMapper.getName().toLowerCase();<br>                    <span class="hljs-comment">// 封装GodMappedStatement对象</span><br>                    <span class="hljs-type">GodMappedStatement</span> <span class="hljs-variable">godMappedStatement</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">GodMappedStatement</span>(sqlId, resultType, sql, parameterType, sqlType);<br>                    mappedStatements.put(namespace + <span class="hljs-string">&quot;.&quot;</span> + sqlId, godMappedStatement);<br>                &#125;);<br>            &#125; <span class="hljs-keyword">catch</span> (DocumentException e) &#123;<br>                <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">RuntimeException</span>(e);<br>            &#125;<br>        &#125;);<br>        <span class="hljs-keyword">return</span> mappedStatements;<br>    &#125;<br><br>    <span class="hljs-keyword">private</span> TransactionManager <span class="hljs-title function_">getTransactionManager</span><span class="hljs-params">(Element transactionManagerElt, DataSource dataSource)</span> &#123;<br>        <span class="hljs-type">String</span> <span class="hljs-variable">type</span> <span class="hljs-operator">=</span> transactionManagerElt.attributeValue(<span class="hljs-string">&quot;type&quot;</span>).toUpperCase();<br>        <span class="hljs-type">TransactionManager</span> <span class="hljs-variable">transactionManager</span> <span class="hljs-operator">=</span> <span class="hljs-literal">null</span>;<br>        <span class="hljs-keyword">if</span> (<span class="hljs-string">&quot;JDBC&quot;</span>.equals(type)) &#123;<br>            <span class="hljs-comment">// 使⽤JDBC事务</span><br>            transactionManager = <span class="hljs-keyword">new</span> <span class="hljs-title class_">GodJDBCTransaction</span>(dataSource, <span class="hljs-literal">false</span>);<br>        &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (<span class="hljs-string">&quot;MANAGED&quot;</span>.equals(type)) &#123;<br>            <span class="hljs-comment">// 事务管理器是交给JEE容器的</span><br>        &#125;<br>        <span class="hljs-keyword">return</span> transactionManager;<br>    &#125;<br><br>    <br>    <br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * 根据xml配置获取数据源</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">private</span> DataSource <span class="hljs-title function_">getDataSource</span><span class="hljs-params">(Element dataSourceElt)</span> &#123;<br>        <span class="hljs-comment">// 获取所有数据源的属性配置</span><br>        Map&lt;String, String&gt; dataSourceMap = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>&lt;&gt;();<br>        dataSourceElt.elements().forEach(propertyElt -&gt; &#123;<br>            dataSourceMap.put(propertyElt.attributeValue(<span class="hljs-string">&quot;name&quot;</span>), propertyElt.attributeValue(<span class="hljs-string">&quot;value&quot;</span>));<br>        &#125;);<br>        <span class="hljs-type">String</span> <span class="hljs-variable">dataSourceType</span> <span class="hljs-operator">=</span> dataSourceElt.attributeValue(<span class="hljs-string">&quot;type&quot;</span>).toUpperCase();<br>        <span class="hljs-type">DataSource</span> <span class="hljs-variable">dataSource</span> <span class="hljs-operator">=</span> <span class="hljs-literal">null</span>;<br>        <span class="hljs-keyword">if</span> (<span class="hljs-string">&quot;POOLED&quot;</span>.equals(dataSourceType)) &#123;<br>            <br>        &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (<span class="hljs-string">&quot;UNPOOLED&quot;</span>.equals(dataSourceType)) &#123;<br>            dataSource = <span class="hljs-keyword">new</span> <span class="hljs-title class_">GodUNPOOLEDDataSource</span>(dataSourceMap.get(<span class="hljs-string">&quot;driver&quot;</span>), dataSourceMap.get(<span class="hljs-string">&quot; url&quot;</span>), dataSourceMap.get(<span class="hljs-string">&quot; username&quot;</span>), dataSourceMap.get(<span class="hljs-string">&quot;password&quot;</span>));<br>        &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (<span class="hljs-string">&quot;JNDI&quot;</span>.equals(dataSourceType)) &#123;<br><br>        &#125;<br>        <span class="hljs-keyword">return</span> dataSource;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<blockquote>
<p>SqlSessionFactory类中有哪些属性   </p>
<p><strong>事务管理器 GodJDBCTransaction</strong>    </p>
<p><strong>SQL映射对象集合 Map&lt;String,GodMapperStatement&gt;</strong></p>
</blockquote>
<h3 id="SqlSessionFactory类"><a href="#SqlSessionFactory类" class="headerlink" title="SqlSessionFactory类"></a>SqlSessionFactory类</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">import</span> javax.sql.DataSource;<br><span class="hljs-keyword">import</span> java.util.List;<br><span class="hljs-keyword">import</span> java.util.Map;<br><br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">SqlSessionFactory</span> &#123;<br>    <span class="hljs-keyword">private</span> TransactionManager transactionManager;<br>    <span class="hljs-keyword">private</span> Map&lt;String, GodMappedStatement&gt; mappedStatements;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">SqlSessionFactory</span><span class="hljs-params">(TransactionManager transactionManager, Map&lt;String, GodMappedStatement&gt; mappedStatements)</span> &#123;<br>        <span class="hljs-built_in">this</span>.transactionManager = transactionManager;<br>        <span class="hljs-built_in">this</span>.mappedStatements = mappedStatements;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> TransactionManager <span class="hljs-title function_">getTransactionManager</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> transactionManager;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setTransactionManager</span><span class="hljs-params">(TransactionManager transactionManager)</span> &#123;<br>        <span class="hljs-built_in">this</span>.transactionManager = transactionManager;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> Map&lt;String, GodMappedStatement&gt; <span class="hljs-title function_">getMappedStatements</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> mappedStatements;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setMappedStatements</span><span class="hljs-params">(Map&lt;String, GodMappedStatement&gt; mappedStatements)</span> &#123;<br>        <span class="hljs-built_in">this</span>.mappedStatements = mappedStatements;<br>    &#125;<br>    <br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * 将事务对象和数据库语句对象传到sqlSession中</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">public</span> SqlSession <span class="hljs-title function_">openSession</span><span class="hljs-params">()</span> &#123;<br>        transactionManager.openConnection();<br>        <span class="hljs-type">SqlSession</span> <span class="hljs-variable">sqlSession</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">SqlSession</span>(transactionManager, mappedStatements);<br>        <span class="hljs-keyword">return</span> sqlSession;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>



<h3 id="SqlSession类"><a href="#SqlSession类" class="headerlink" title="SqlSession类"></a>SqlSession类</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">import</span> java.sql.SQLException;<br><span class="hljs-keyword">import</span> java.util.Map;<br><br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">SqlSession</span> &#123;<br>    <span class="hljs-keyword">private</span> TransactionManager transactionManager;<br>    <span class="hljs-keyword">private</span> Map&lt;String, GodMappedStatement&gt; mappedStatements;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">SqlSession</span><span class="hljs-params">(TransactionManager transactionManager, Map&lt;String, GodMappedStatement&gt;mappedStatements)</span> &#123;<br>        <span class="hljs-built_in">this</span>.transactionManager = transactionManager;<br>        <span class="hljs-built_in">this</span>.mappedStatements = mappedStatements;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">commit</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">try</span> &#123;<br>            transactionManager.getConnection().commit();<br>        &#125; <span class="hljs-keyword">catch</span> (SQLException e) &#123;<br>            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">RuntimeException</span>(e);<br>        &#125;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">rollback</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">try</span> &#123;<br>            transactionManager.getConnection().rollback();<br>        &#125; <span class="hljs-keyword">catch</span> (SQLException e) &#123;<br>            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">RuntimeException</span>(e);<br>        &#125;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">close</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">try</span> &#123;<br>            transactionManager.getConnection().close();<br>        &#125; <span class="hljs-keyword">catch</span> (SQLException e) &#123;<br>            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">RuntimeException</span>(e);<br>        &#125;<br>    &#125;<br>    <br>    <br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * 插⼊数据</span><br><span class="hljs-comment">     *</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> sqlId 要执⾏的sqlId</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> obj   插⼊的数据</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span></span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-title function_">insert</span><span class="hljs-params">(String sqlId, Object obj)</span> &#123;<br>        <span class="hljs-type">GodMappedStatement</span> <span class="hljs-variable">godMappedStatement</span> <span class="hljs-operator">=</span> mappedStatements.get(sqlId);<br>        <span class="hljs-type">Connection</span> <span class="hljs-variable">connection</span> <span class="hljs-operator">=</span> transactionManager.getConnection();<br>        <span class="hljs-comment">// 获取sql语句</span><br>        <span class="hljs-comment">// insert into t_car(id,car_num,brand,guide_price,produce_time,car_type)values(null,# &#123;carNum&#125;,#&#123;brand&#125;,#&#123;guidePrice&#125;,#&#123;produceTime&#125;,#&#123;carType&#125;)</span><br>        <span class="hljs-type">String</span> <span class="hljs-variable">godbatisSql</span> <span class="hljs-operator">=</span> godMappedStatement.getSql();<br>        <span class="hljs-comment">// insert into t_car(id,car_num,brand,guide_price,produce_time,car_type)values(null, ?,?,?,?,?)</span><br>        <span class="hljs-type">String</span> <span class="hljs-variable">sql</span> <span class="hljs-operator">=</span> godbatisSql.replaceAll(<span class="hljs-string">&quot;#\\&#123;[a-zA-Z0-9_\\$]*&#125;&quot;</span>, <span class="hljs-string">&quot;?&quot;</span>);<br>        <span class="hljs-comment">// 重点⼀步</span><br>        Map&lt;Integer, String&gt; map = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>&lt;&gt;();<br>        <span class="hljs-type">int</span> <span class="hljs-variable">index</span> <span class="hljs-operator">=</span> <span class="hljs-number">1</span>;<br>        <span class="hljs-keyword">while</span> (godbatisSql.indexOf(<span class="hljs-string">&quot;#&quot;</span>) &gt;= <span class="hljs-number">0</span>) &#123;<br>            <span class="hljs-type">int</span> <span class="hljs-variable">beginIndex</span> <span class="hljs-operator">=</span> godbatisSql.indexOf(<span class="hljs-string">&quot;#&quot;</span>) + <span class="hljs-number">2</span>;<br>            <span class="hljs-type">int</span> <span class="hljs-variable">endIndex</span> <span class="hljs-operator">=</span> godbatisSql.indexOf(<span class="hljs-string">&quot;&#125;&quot;</span>);<br>            map.put(index++, godbatisSql.substring(beginIndex, endIndex).trim( ));<br>            godbatisSql = godbatisSql.substring(endIndex + <span class="hljs-number">1</span>);<br>        &#125;<br>        <span class="hljs-keyword">final</span> PreparedStatement ps;<br>        <span class="hljs-keyword">try</span> &#123;<br>            ps = connection.prepareStatement(sql);<br>            <span class="hljs-comment">// 给?赋值</span><br>            map.forEach((k, v) -&gt; &#123;<br>                <span class="hljs-keyword">try</span> &#123;<br>                    <span class="hljs-comment">// 获取java实体类的get⽅法名</span><br>                    <span class="hljs-type">String</span> <span class="hljs-variable">getMethodName</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;get&quot;</span> + v.toUpperCase().charAt(<span class="hljs-number">0</span>) +<br>                            v.substring(<span class="hljs-number">1</span>);<br>                    <span class="hljs-type">Method</span> <span class="hljs-variable">getMethod</span> <span class="hljs-operator">=</span> obj.getClass().getDeclaredMethod(getMethodName);<br>                    ps.setString(k, getMethod.invoke(obj).toString());<br>                &#125; <span class="hljs-keyword">catch</span> (Exception e) &#123;<br>                    <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">RuntimeException</span>(e);<br>                &#125;<br>            &#125;);<br>            <span class="hljs-type">int</span> <span class="hljs-variable">count</span> <span class="hljs-operator">=</span> ps.executeUpdate();<br>            ps.close();<br>            <span class="hljs-keyword">return</span> count;<br>        &#125; <span class="hljs-keyword">catch</span> (Exception e) &#123;<br>            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">RuntimeException</span>(e);<br>        &#125;<br>    &#125;<br>    <br>     <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * 查询⼀个对象</span><br><span class="hljs-comment">     *</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> sqlId</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> parameterObj</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span></span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">public</span> Object <span class="hljs-title function_">selectOne</span><span class="hljs-params">(String sqlId, Object parameterObj)</span> &#123;<br>        <span class="hljs-type">GodMappedStatement</span> <span class="hljs-variable">godMappedStatement</span> <span class="hljs-operator">=</span> mappedStatements.get(sqlId);<br>        <span class="hljs-type">Connection</span> <span class="hljs-variable">connection</span> <span class="hljs-operator">=</span> transactionManager.getConnection();<br>        <span class="hljs-comment">// 获取sql语句</span><br>        <span class="hljs-type">String</span> <span class="hljs-variable">godbatisSql</span> <span class="hljs-operator">=</span> godMappedStatement.getSql();<br>        <span class="hljs-type">String</span> <span class="hljs-variable">sql</span> <span class="hljs-operator">=</span> godbatisSql.replaceAll(<span class="hljs-string">&quot;#\\&#123;[a-zA-Z0-9_\\$]*&#125;&quot;</span>, <span class="hljs-string">&quot;?&quot;</span>);<br>        <span class="hljs-comment">// 执⾏sql</span><br>        <span class="hljs-type">PreparedStatement</span> <span class="hljs-variable">ps</span> <span class="hljs-operator">=</span> <span class="hljs-literal">null</span>;<br>        <span class="hljs-type">ResultSet</span> <span class="hljs-variable">rs</span> <span class="hljs-operator">=</span> <span class="hljs-literal">null</span>;<br>        <span class="hljs-type">Object</span> <span class="hljs-variable">obj</span> <span class="hljs-operator">=</span> <span class="hljs-literal">null</span>;<br>        <span class="hljs-keyword">try</span> &#123;<br>            ps = connection.prepareStatement(sql);<br>            ps.setString(<span class="hljs-number">1</span>, parameterObj.toString());<br>            rs = ps.executeQuery();<br>            <span class="hljs-keyword">if</span> (rs.next()) &#123;<br>                <span class="hljs-comment">// 将结果集封装对象，通过反射</span><br>                <span class="hljs-type">String</span> <span class="hljs-variable">resultType</span> <span class="hljs-operator">=</span> godMappedStatement.getResultType();<br>                Class&lt;?&gt; aClass = Class.forName(resultType);<br>                Constructor&lt;?&gt; con = aClass.getDeclaredConstructor();<br>                obj = con.newInstance();<br>                <span class="hljs-comment">// 给对象obj属性赋值</span><br>                <span class="hljs-type">ResultSetMetaData</span> <span class="hljs-variable">rsmd</span> <span class="hljs-operator">=</span> rs.getMetaData();<br>                <span class="hljs-type">int</span> <span class="hljs-variable">columnCount</span> <span class="hljs-operator">=</span> rsmd.getColumnCount();<br>                <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">1</span>; i &lt;= columnCount; i++) &#123;<br>                    <span class="hljs-type">String</span> <span class="hljs-variable">columnName</span> <span class="hljs-operator">=</span> rsmd.getColumnName(i);<br>                    <span class="hljs-type">String</span> <span class="hljs-variable">setMethodName</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;set&quot;</span> + columnName.toUpperCase().ch<br>                    <span class="hljs-title function_">arAt</span><span class="hljs-params">(<span class="hljs-number">0</span>)</span> + columnName.substring(<span class="hljs-number">1</span>);<br>                    <span class="hljs-type">Method</span> <span class="hljs-variable">setMethod</span> <span class="hljs-operator">=</span> aClass.getDeclaredMethod(setMethodName,<br>                            aClass.getDeclaredField(columnName).getType());<br>                    setMethod.invoke(obj, rs.getString(columnName));<br>                &#125;<br>            &#125;<br>        &#125; <span class="hljs-keyword">catch</span> (Exception e) &#123;<br>            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">RuntimeException</span>(e);<br>        &#125; <span class="hljs-keyword">finally</span> &#123;<br>            <span class="hljs-keyword">if</span> (rs != <span class="hljs-literal">null</span>) &#123;<br>                <span class="hljs-keyword">try</span> &#123;<br>                    rs.close();<br>                &#125; <span class="hljs-keyword">catch</span> (SQLException e) &#123;<br>                    <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">RuntimeException</span>(e);<br>                &#125;<br>            &#125;<br>            <span class="hljs-keyword">try</span> &#123;<br>                ps.close();<br>            &#125; <span class="hljs-keyword">catch</span> (SQLException e) &#123;<br>                <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">RuntimeException</span>(e);<br>            &#125;<br>        &#125;<br>        <span class="hljs-keyword">return</span> obj;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>



<h3 id="事务管理器接⼝"><a href="#事务管理器接⼝" class="headerlink" title="事务管理器接⼝"></a>事务管理器接⼝</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">import</span> java.sql.Connection;<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * 事务管理器接⼝</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">TransactionManager</span> &#123;<br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * 提交事务</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">void</span> <span class="hljs-title function_">commit</span><span class="hljs-params">()</span>;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * 回滚事务</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">void</span> <span class="hljs-title function_">rollback</span><span class="hljs-params">()</span>;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * 关闭事务</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">void</span> <span class="hljs-title function_">close</span><span class="hljs-params">()</span>;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * 开启连接</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">void</span> <span class="hljs-title function_">openConnection</span><span class="hljs-params">()</span>;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * 获取连接对象</span><br><span class="hljs-comment">     *</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span> 连接对象</span><br><span class="hljs-comment">     */</span><br>    Connection <span class="hljs-title function_">getConnection</span><span class="hljs-params">()</span>;<br>&#125;<br></code></pre></td></tr></table></figure>



<h3 id="GodJDBCTransaction"><a href="#GodJDBCTransaction" class="headerlink" title="GodJDBCTransaction"></a>GodJDBCTransaction</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">import</span> javax.sql.DataSource;<br><span class="hljs-keyword">import</span> java.sql.Connection;<br><span class="hljs-keyword">import</span> java.sql.SQLException;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">GodJDBCTransaction</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">TransactionManager</span> &#123;<br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * 连接对象，控制事务时需要</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">private</span> Connection conn;<br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * 数据源对象</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">private</span> DataSource dataSource;<br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * ⾃动提交标志：</span><br><span class="hljs-comment">     * true表示⾃动提交</span><br><span class="hljs-comment">     * false表示不⾃动提交</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">private</span> <span class="hljs-type">boolean</span> autoCommit;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * 构造事务管理器对象</span><br><span class="hljs-comment">     *</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> autoCommit</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">GodJDBCTransaction</span><span class="hljs-params">(DataSource dataSource, <span class="hljs-type">boolean</span> autoCommit)</span> &#123;<br>        <span class="hljs-built_in">this</span>.dataSource = dataSource;<br>        <span class="hljs-built_in">this</span>.autoCommit = autoCommit;<br>    &#125;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * 提交事务</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">commit</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">try</span> &#123;<br>            conn.commit();<br>        &#125; <span class="hljs-keyword">catch</span> (SQLException e) &#123;<br>            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">RuntimeException</span>(e);<br>        &#125;<br>    &#125;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * 回滚事务</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">rollback</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">try</span> &#123;<br>            conn.rollback();<br>        &#125; <span class="hljs-keyword">catch</span> (SQLException e) &#123;<br>            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">RuntimeException</span>(e);<br>        &#125;<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">close</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">try</span> &#123;<br>            conn.close();<br>        &#125; <span class="hljs-keyword">catch</span> (SQLException e) &#123;<br>            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">RuntimeException</span>(e);<br>        &#125;<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">openConnection</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">try</span> &#123;<br>            <span class="hljs-built_in">this</span>.conn = dataSource.getConnection();<br>            <span class="hljs-built_in">this</span>.conn.setAutoCommit(<span class="hljs-built_in">this</span>.autoCommit);<br>        &#125; <span class="hljs-keyword">catch</span> (SQLException e) &#123;<br>            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">RuntimeException</span>(e);<br>        &#125;<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> Connection <span class="hljs-title function_">getConnection</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> conn;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>



<h3 id="GodUNPOOLEDDataSource数据源"><a href="#GodUNPOOLEDDataSource数据源" class="headerlink" title="GodUNPOOLEDDataSource数据源"></a>GodUNPOOLEDDataSource数据源</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">import</span> java.io.PrintWriter;<br><span class="hljs-keyword">import</span> java.sql.Connection;<br><span class="hljs-keyword">import</span> java.sql.DriverManager;<br><span class="hljs-keyword">import</span> java.sql.SQLException;<br><span class="hljs-keyword">import</span> java.sql.SQLFeatureNotSupportedException;<br><span class="hljs-keyword">import</span> java.util.logging.Logger;<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * 数据源实现类，不使⽤连接池</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">GodUNPOOLEDDataSource</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">javax</span>.sql.DataSource &#123;<br>    <span class="hljs-keyword">private</span> String url;<br>    <span class="hljs-keyword">private</span> String username;<br>    <span class="hljs-keyword">private</span> String password;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">GodUNPOOLEDDataSource</span><span class="hljs-params">(String driver, String url, String username, String password)</span> &#123;<br>        <span class="hljs-keyword">try</span> &#123;<br>            <span class="hljs-comment">// 注册驱动</span><br>            Class.forName(driver);<br>        &#125; <span class="hljs-keyword">catch</span> (ClassNotFoundException e) &#123;<br>            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">RuntimeException</span>(e);<br>        &#125;<br>        <span class="hljs-built_in">this</span>.url = url;<br>        <span class="hljs-built_in">this</span>.username = username;<br>        <span class="hljs-built_in">this</span>.password = password;<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> Connection <span class="hljs-title function_">getConnection</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> SQLException &#123;<br>        <span class="hljs-keyword">return</span> DriverManager.getConnection(url, username, password);<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> Connection <span class="hljs-title function_">getConnection</span><span class="hljs-params">(String username, String password)</span> <span class="hljs-keyword">throws</span> SQLException &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> PrintWriter <span class="hljs-title function_">getLogWriter</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> SQLException &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setLogWriter</span><span class="hljs-params">(PrintWriter out)</span> <span class="hljs-keyword">throws</span> SQLException &#123;<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setLoginTimeout</span><span class="hljs-params">(<span class="hljs-type">int</span> seconds)</span> <span class="hljs-keyword">throws</span> SQLException &#123;<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-title function_">getLoginTimeout</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> SQLException &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> Logger <span class="hljs-title function_">getParentLogger</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> SQLFeatureNotSupportedException &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> &lt;T&gt; T <span class="hljs-title function_">unwrap</span><span class="hljs-params">(Class&lt;T&gt; iface)</span> <span class="hljs-keyword">throws</span> SQLException &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">isWrapperFor</span><span class="hljs-params">(Class&lt;?&gt; iface)</span> <span class="hljs-keyword">throws</span> SQLException &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>



<h3 id="GodMappedStatement"><a href="#GodMappedStatement" class="headerlink" title="GodMappedStatement"></a>GodMappedStatement</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">GodMappedStatement</span> &#123;<br>    <span class="hljs-keyword">private</span> String sqlId;<br>    <span class="hljs-keyword">private</span> String resultType;<br>    <span class="hljs-keyword">private</span> String sql;<br>    <span class="hljs-keyword">private</span> String parameterType;<br>    <span class="hljs-keyword">private</span> String sqlType;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">toString</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;GodMappedStatement&#123;&quot;</span> +<br>                <span class="hljs-string">&quot;sqlId=&#x27;&quot;</span> + sqlId + <span class="hljs-string">&#x27;\&#x27;&#x27;</span> +<br>                <span class="hljs-string">&quot;, resultType=&#x27;&quot;</span> + resultType + <span class="hljs-string">&#x27;\&#x27;&#x27;</span> +<br>                <span class="hljs-string">&quot;, sql=&#x27;&quot;</span> + sql + <span class="hljs-string">&#x27;\&#x27;&#x27;</span> +<br>                <span class="hljs-string">&quot;, parameterType=&#x27;&quot;</span> + parameterType + <span class="hljs-string">&#x27;\&#x27;&#x27;</span> +<br>                <span class="hljs-string">&quot;, sqlType=&#x27;&quot;</span> + sqlType + <span class="hljs-string">&#x27;\&#x27;&#x27;</span> +<br>                <span class="hljs-string">&#x27;&#125;&#x27;</span>;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getSqlId</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> sqlId;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setSqlId</span><span class="hljs-params">(String sqlId)</span> &#123;<br>        <span class="hljs-built_in">this</span>.sqlId = sqlId;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getResultType</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> resultType;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setResultType</span><span class="hljs-params">(String resultType)</span> &#123;<br>        <span class="hljs-built_in">this</span>.resultType = resultType;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getSql</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> sql;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setSql</span><span class="hljs-params">(String sql)</span> &#123;<br>        <span class="hljs-built_in">this</span>.sql = sql;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getParameterType</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> parameterType;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setParameterType</span><span class="hljs-params">(String parameterType)</span> &#123;<br>        <span class="hljs-built_in">this</span>.parameterType = parameterType;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getSqlType</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> sqlType;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setSqlType</span><span class="hljs-params">(String sqlType)</span> &#123;<br>        <span class="hljs-built_in">this</span>.sqlType = sqlType;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">GodMappedStatement</span><span class="hljs-params">(String sqlId, String resultType, String sql, String parameterType, String sqlType)</span> &#123;<br>        <span class="hljs-built_in">this</span>.sqlId = sqlId;<br>        <span class="hljs-built_in">this</span>.resultType = resultType;<br>        <span class="hljs-built_in">this</span>.sql = sql;<br>        <span class="hljs-built_in">this</span>.parameterType = parameterType;<br>        <span class="hljs-built_in">this</span>.sqlType = sqlType;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>





<h3 id="编写核⼼配置⽂件："><a href="#编写核⼼配置⽂件：" class="headerlink" title="编写核⼼配置⽂件："></a>编写核⼼配置⽂件：</h3><p>godbatis-config.xml</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-meta">&lt;?xml version=<span class="hljs-string">&quot;1.0&quot;</span> encoding=<span class="hljs-string">&quot;UTF-8&quot;</span> ?&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">configuration</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">environments</span> <span class="hljs-attr">default</span>=<span class="hljs-string">&quot;dev&quot;</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">environment</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;dev&quot;</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">transactionManager</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;JDBC&quot;</span>/&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">dataSource</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;UNPOOLED&quot;</span>&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;driver&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;com.mysql.cj.jdbc.Driver&quot;</span>/&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;url&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;jdbc:mysql://localhost:3306/powernode&quot;</span>/&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;username&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;root&quot;</span>/&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;password&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;root&quot;</span>/&gt;</span><br>            <span class="hljs-tag">&lt;/<span class="hljs-name">dataSource</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">environment</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">mappers</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">mapper</span> <span class="hljs-attr">resource</span>=<span class="hljs-string">&quot;UserMapper.xml&quot;</span>/&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">mappers</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">environments</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">configuration</span>&gt;</span><br></code></pre></td></tr></table></figure>



<h3 id="编写sql映射⽂件："><a href="#编写sql映射⽂件：" class="headerlink" title="编写sql映射⽂件："></a>编写sql映射⽂件：</h3><p>UserMapper.xml</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-meta">&lt;?xml version=<span class="hljs-string">&quot;1.0&quot;</span> encoding=<span class="hljs-string">&quot;UTF-8&quot;</span> ?&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">mapper</span> <span class="hljs-attr">namespace</span>=<span class="hljs-string">&quot;user&quot;</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">insert</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;insertUser&quot;</span>&gt;</span><br>        insert into t_user(id,name,email,address) values(#&#123;id&#125;,#&#123;name&#125;,#&#123;email&#125;,#&#123;address&#125;)<br>    <span class="hljs-tag">&lt;/<span class="hljs-name">insert</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">select</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;selectUserById&quot;</span> <span class="hljs-attr">resultType</span>=<span class="hljs-string">&quot;com.powernode.godbatis.pojo.User&quot;</span>&gt;</span><br>        select * from t_user where id = #&#123;id&#125;<br>    <span class="hljs-tag">&lt;/<span class="hljs-name">select</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">mapper</span>&gt;</span><br></code></pre></td></tr></table></figure>



<h3 id="编写测试类"><a href="#编写测试类" class="headerlink" title="编写测试类"></a>编写测试类</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">import</span> com.powernode.godbatis.pojo.User;<br><span class="hljs-keyword">import</span> org.god.core.Resources;<br><span class="hljs-keyword">import</span> org.god.core.SqlSession;<br><span class="hljs-keyword">import</span> org.god.core.SqlSessionFactory;<br><span class="hljs-keyword">import</span> org.god.core.SqlSessionFactoryBuilder;<br><span class="hljs-keyword">import</span> org.junit.Test;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">GodBatisTest</span> &#123;<br><br>    <span class="hljs-meta">@Test</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">testInsertUser</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> Exception &#123;<br>        <span class="hljs-type">User</span> <span class="hljs-variable">user</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">User</span>(<span class="hljs-string">&quot;1&quot;</span>, <span class="hljs-string">&quot;zhangsan&quot;</span>, <span class="hljs-string">&quot;zhangsan@1234.com&quot;</span>, <span class="hljs-string">&quot;北京⼤兴区&quot;</span>);<br>        <span class="hljs-type">SqlSessionFactoryBuilder</span> <span class="hljs-variable">sqlSessionFactoryBuilder</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">SqlSessionFactoryBuilder</span>();<br>        <span class="hljs-type">SqlSessionFactory</span> <span class="hljs-variable">sqlSessionFactory</span> <span class="hljs-operator">=</span> sqlSessionFactoryBuilder.build(Resources.getResourcesAsStream(<span class="hljs-string">&quot;godbatis-config.xml&quot;</span>));<br>        <span class="hljs-type">SqlSession</span> <span class="hljs-variable">sqlSession</span> <span class="hljs-operator">=</span> sqlSessionFactory.openSession();<br>        <span class="hljs-type">int</span> <span class="hljs-variable">count</span> <span class="hljs-operator">=</span> sqlSession.insert(<span class="hljs-string">&quot;user.insertUser&quot;</span>, user);<br>        System.out.println(<span class="hljs-string">&quot;插⼊了⼏条记录：&quot;</span> + count);<br>        sqlSession.commit();<br>        sqlSession.close();<br>    &#125;<br><br>    <span class="hljs-meta">@Test</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">testSelectUserById</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> Exception &#123;<br>        <span class="hljs-type">SqlSessionFactoryBuilder</span> <span class="hljs-variable">sqlSessionFactoryBuilder</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">SqlSessionFactoryBuilder</span>();<br>        <span class="hljs-type">SqlSessionFactory</span> <span class="hljs-variable">sqlSessionFactory</span> <span class="hljs-operator">=</span> sqlSessionFactoryBuilder.buid(Resources.getResourcesAsStream(<span class="hljs-string">&quot;godbatis-config.xml&quot;</span>));<br>        <span class="hljs-type">SqlSession</span> <span class="hljs-variable">sqlSession</span> <span class="hljs-operator">=</span> sqlSessionFactory.openSession();<br>        <span class="hljs-type">Object</span> <span class="hljs-variable">user</span> <span class="hljs-operator">=</span> sqlSession.selectOne(<span class="hljs-string">&quot;user.selectUserById&quot;</span>, <span class="hljs-string">&quot;1&quot;</span>);<br>        System.out.println(user);<br>        sqlSession.close();<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<h3 id="运⾏结果"><a href="#运⾏结果" class="headerlink" title="运⾏结果"></a>运⾏结果</h3><hr>
<p><img src="https://cdn.jsdelivr.net/gh/fgcy-333/gitnote-images/2023/5/16202305192254970.png" srcset="/img/loading.gif" lazyload alt="image-20230519225346538"></p>
<hr>
<p><img src="https://cdn.jsdelivr.net/gh/fgcy-333/gitnote-images/2023/5/16202305192254021.png" srcset="/img/loading.gif" lazyload alt="image-20230519225400731"></p>
<hr>
<h2 id="5-5-总结MyBatis框架的重要实现原理"><a href="#5-5-总结MyBatis框架的重要实现原理" class="headerlink" title="5.5 总结MyBatis框架的重要实现原理"></a>5.5 总结MyBatis框架的重要实现原理</h2><p>为什么insert语句中 #{} ⾥填写的必须是属性名？</p>
<p>因为会使用反射调用对象的setter方法获取对象属性值。其中根据 get属性名第一个字符大写其他小写拼接 方法名</p>
<p>为什么select语句查询结果列名要属性名⼀致？</p>
<p>通过列名 拼接对象的setter方法，通过反射给对象赋值</p>

                
              </div>
            
            <hr/>
            <div>
              <div class="post-metas my-3">
  
    <div class="post-meta mr-3 d-flex align-items-center">
      <i class="iconfont icon-category"></i>
      

<span class="category-chains">
  
  
    
      <span class="category-chain">
        
  <a href="/categories/%E5%AD%A6%E4%B9%A0/" class="category-chain-item">学习</a>
  
  

      </span>
    
  
</span>

    </div>
  
  
    <div class="post-meta">
      <i class="iconfont icon-tags"></i>
      
        <a href="/tags/java/">#java</a>
      
        <a href="/tags/SSM/">#SSM</a>
      
        <a href="/tags/MyBatis/">#MyBatis</a>
      
        <a href="/tags/ORM%E6%A1%86%E6%9E%B6/">#ORM框架</a>
      
    </div>
  
</div>


              
  

  <div class="license-box my-3">
    <div class="license-title">
      <div>Mybatis(du)</div>
      <div>http://example.com/2023/05/14/老杜-Mybatis/</div>
    </div>
    <div class="license-meta">
      
        <div class="license-meta-item">
          <div>Author</div>
          <div>John Doe</div>
        </div>
      
      
        <div class="license-meta-item license-meta-date">
          <div>Posted on</div>
          <div>May 14, 2023</div>
        </div>
      
      
      
        <div class="license-meta-item">
          <div>Licensed under</div>
          <div>
            
              
              
                <a target="_blank" href="https://creativecommons.org/licenses/by/4.0/">
                  <span class="hint--top hint--rounded" aria-label="BY - Attribution">
                    <i class="iconfont icon-by"></i>
                  </span>
                </a>
              
            
          </div>
        </div>
      
    </div>
    <div class="license-icon iconfont"></div>
  </div>



              
                <div class="post-prevnext my-3">
                  <article class="post-prev col-6">
                    
                    
                  </article>
                  <article class="post-next col-6">
                    
                    
                      <a href="/2023/05/06/%E8%80%81%E6%9D%9C-spring6/" title="spring6(du)">
                        <span class="hidden-mobile">spring6(du)</span>
                        <span class="visible-mobile">Next</span>
                        <i class="iconfont icon-arrowright"></i>
                      </a>
                    
                  </article>
                </div>
              
            </div>

            
  
  
    <article id="comments" lazyload>
      

    </article>
  


          </article>
        </div>
      </div>
    </div>

    <div class="side-col d-none d-lg-block col-lg-2">
      
  <aside class="sidebar" style="margin-left: -1rem">
    <div id="toc">
  <p class="toc-header">
    <i class="iconfont icon-list"></i>
    <span>Table of Contents</span>
  </p>
  <div class="toc-body" id="toc-body"></div>
</div>



  </aside>


    </div>
  </div>
</div>





  



  



  



  



  







    

    
      <a id="scroll-top-button" aria-label="TOP" href="#" role="button">
        <i class="iconfont icon-arrowup" aria-hidden="true"></i>
      </a>
    

    
      <div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel"
     aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header text-center">
        <h4 class="modal-title w-100 font-weight-bold">Search</h4>
        <button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body mx-3">
        <div class="md-form mb-5">
          <input type="text" id="local-search-input" class="form-control validate">
          <label data-error="x" data-success="v" for="local-search-input">Keyword</label>
        </div>
        <div class="list-group" id="local-search-result"></div>
      </div>
    </div>
  </div>
</div>

    

    
  </main>

  <footer>
    <div class="footer-inner">
  
    <div class="footer-content">
       <i class="iconfont icon-love"></i> <a href="https://github.com/fluid-dev/hexo-theme-fluid" target="_blank" rel="nofollow noopener"><span>WAITING</span></a> 
    </div>
  
  
    <div class="statistics">
  
  

  
    
      <span id="busuanzi_container_site_pv" style="display: none">
        总访问量 
        <span id="busuanzi_value_site_pv"></span>
         次
      </span>
    
    
      <span id="busuanzi_container_site_uv" style="display: none">
        总访客数 
        <span id="busuanzi_value_site_uv"></span>
         人
      </span>
    
    
  
</div>

  
  
  
</div>

  </footer>

  <!-- Scripts -->
  
  <script  src="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.js" ></script>
  <link  rel="stylesheet" href="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.css" />

  <script>
    NProgress.configure({"showSpinner":false,"trickleSpeed":100})
    NProgress.start()
    window.addEventListener('load', function() {
      NProgress.done();
    })
  </script>


<script  src="https://lib.baomitu.com/jquery/3.6.0/jquery.min.js" ></script>
<script  src="https://lib.baomitu.com/twitter-bootstrap/4.6.1/js/bootstrap.min.js" ></script>
<script  src="/js/events.js" ></script>
<script  src="/js/plugins.js" ></script>


  <script  src="https://lib.baomitu.com/typed.js/2.0.12/typed.min.js" ></script>
  <script>
    (function (window, document) {
      var typing = Fluid.plugins.typing;
      var subtitle = document.getElementById('subtitle');
      if (!subtitle || !typing) {
        return;
      }
      var text = subtitle.getAttribute('data-typed-text');
      
        typing(text);
      
    })(window, document);
  </script>




  
    <script  src="/js/img-lazyload.js" ></script>
  




  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/tocbot/4.18.2/tocbot.min.js', function() {
    var toc = jQuery('#toc');
    if (toc.length === 0 || !window.tocbot) { return; }
    var boardCtn = jQuery('#board-ctn');
    var boardTop = boardCtn.offset().top;

    window.tocbot.init(Object.assign({
      tocSelector     : '#toc-body',
      contentSelector : '.markdown-body',
      linkClass       : 'tocbot-link',
      activeLinkClass : 'tocbot-active-link',
      listClass       : 'tocbot-list',
      isCollapsedClass: 'tocbot-is-collapsed',
      collapsibleClass: 'tocbot-is-collapsible',
      scrollSmooth    : true,
      includeTitleTags: true,
      headingsOffset  : -boardTop,
    }, CONFIG.toc));
    if (toc.find('.toc-list-item').length > 0) {
      toc.css('visibility', 'visible');
    }

    Fluid.events.registerRefreshCallback(function() {
      if ('tocbot' in window) {
        tocbot.refresh();
        var toc = jQuery('#toc');
        if (toc.length === 0 || !tocbot) {
          return;
        }
        if (toc.find('.toc-list-item').length > 0) {
          toc.css('visibility', 'visible');
        }
      }
    });
  });
</script>


  <script src=https://lib.baomitu.com/clipboard.js/2.0.11/clipboard.min.js></script>

  <script>Fluid.plugins.codeWidget();</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/anchor-js/4.3.1/anchor.min.js', function() {
    window.anchors.options = {
      placement: CONFIG.anchorjs.placement,
      visible  : CONFIG.anchorjs.visible
    };
    if (CONFIG.anchorjs.icon) {
      window.anchors.options.icon = CONFIG.anchorjs.icon;
    }
    var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
    var res = [];
    for (var item of el) {
      res.push('.markdown-body > ' + item.trim());
    }
    if (CONFIG.anchorjs.placement === 'left') {
      window.anchors.options.class = 'anchorjs-link-left';
    }
    window.anchors.add(res.join(', '));

    Fluid.events.registerRefreshCallback(function() {
      if ('anchors' in window) {
        anchors.removeAll();
        var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
        var res = [];
        for (var item of el) {
          res.push('.markdown-body > ' + item.trim());
        }
        if (CONFIG.anchorjs.placement === 'left') {
          anchors.options.class = 'anchorjs-link-left';
        }
        anchors.add(res.join(', '));
      }
    });
  });
</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.js', function() {
    Fluid.plugins.fancyBox();
  });
</script>


  <script>Fluid.plugins.imageCaption();</script>

  <script  src="/js/local-search.js" ></script>

  <script defer src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js" ></script>





<!-- 主题的启动项，将它保持在最底部 -->
<!-- the boot of the theme, keep it at the bottom -->
<script  src="/js/boot.js" ></script>


  

  <noscript>
    <div class="noscript-warning">Blog works best with JavaScript enabled</div>
  </noscript>
</body>
</html>
